{"version":3,"sources":["deparam.ts","repo-regex.ts","vartalk-api.ts","oauth.ts","page-attributes.ts","encoding.ts","github.ts","time-ago.ts","measure.ts","reactions.ts","comment-component.ts","timeline-component.ts","repo-config.ts","new-comment-component.ts","theme.ts","vartalk.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAM,SAAU,OAAV,CAAkB,KAAlB,EAA+B;AACjC,MAAI,KAAJ;AACA,MAAM,IAAI,GAAG,KAAb;AACA,MAAM,MAAM,GAAG,oBAAf;;AACA,MAAM,MAAM,GAAG,SAAT,MAAS,CAAC,CAAD,EAAU;AAAK,WAAA,kBAAkB,CAAC,CAAC,CAAC,OAAF,CAAU,IAAV,EAAgB,GAAhB,CAAD,CAAlB;AAAwC,GAAtE;;AACA,MAAM,MAAM,GAA2B,EAAvC;;AAGA,SAAO,KAAK,GAAG,MAAM,CAAC,IAAP,CAAY,KAAZ,CAAf,EAAmC;AAC/B,IAAA,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAD,CAAN,CAAP,CAAN,GAA2B,MAAM,CAAC,KAAK,CAAC,CAAD,CAAN,CAAjC;AACH;;AAED,SAAO,MAAP;AACH;;AAEK,SAAU,KAAV,CAAgB,GAAhB,EAA2C;AAC7C,MAAM,KAAK,GAAG,EAAd;;AAEA,OAAK,IAAM,IAAX,IAAmB,GAAnB,EAAwB;AACpB,QAAI,GAAG,CAAC,cAAJ,CAAmB,IAAnB,KAA4B,GAAG,CAAC,IAAD,CAAnC,EAA2C;AACvC,MAAA,KAAK,CAAC,IAAN,CAAc,kBAAkB,CAAC,IAAD,CAAlB,GAAwB,GAAxB,GAA4B,kBAAkB,CAAC,GAAG,CAAC,IAAD,CAAJ,CAA5D;AACH;AACJ;;AAED,SAAO,KAAK,CAAC,IAAN,CAAW,GAAX,CAAP;AACH;;;;;;;;eCzBc;;;;;;;;;ACCR,IAAM,cAAc,GAAG,wBAAvB;;;;;;;;;;;;ACDP;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEO,IAAM,KAAK,GAAG;AAAE,EAAA,KAAK,EAAE;AAAT,CAAd;;;AAGD,SAAU,WAAV,CAAsB,YAAtB,EAA0C;AAC5C,SAAU,6BAAc,aAAd,GAA4B,oBAAM;AAAE,IAAA,YAAY,EAAA;AAAd,GAAN,CAAtC;AACH;;AAEK,SAAgB,SAAhB,GAAyB;iCAAI,SAAO,YAAA;;;;;AACtC,cAAI,KAAK,CAAC,KAAV,EAAiB;AACb,mBAAA,CAAA,CAAA,EAAO,KAAK,CAAC,KAAb,CAAA;AACH;;AAEK,UAAA,GAAG,GAAM,6BAAc,QAAvB;AACW,iBAAA,CAAA,CAAA,EAAM,KAAK,CAAC,GAAD,EAAM;AAC9B,YAAA,MAAM,EAAE,MADsB;AAE9B,YAAA,IAAI,EAAE,MAFwB;AAG9B,YAAA,WAAW,EAAE;AAHiB,WAAN,CAAX,CAAA;;;AAAX,UAAA,QAAQ,GAAG,EAAA,CAAA,IAAA,EAAX;eAMF,QAAQ,CAAC,IAAT,OAAA,CAAA,CAAA,EAAA,CAAA,CAAA;AACU,iBAAA,CAAA,CAAA,EAAM,QAAQ,CAAC,IAAT,EAAN,CAAA;;;AAAJ,UAAA,CAAC,GAAG,EAAA,CAAA,IAAA,EAAJ;AAEN,UAAA,KAAK,CAAC,KAAN,GAAc,CAAd;AAEA,iBAAA,CAAA,CAAA,EAAO,CAAP,CAAA;;;AAGJ,iBAAA,CAAA,CAAA,EAAO,IAAP,CAAA;;;;AACH;;;;;;;;;AC/BD;;AACA;;AACA;;;;AAEA,SAAS,kBAAT,GAA2B;AACvB,MAAM,MAAM,GAAG,sBAAQ,QAAQ,CAAC,MAAT,CAAgB,MAAhB,CAAuB,CAAvB,CAAR,CAAf;AAEA,MAAI,SAAS,GAAkB,IAA/B;AACA,MAAI,WAAW,GAAkB,IAAjC;;AAEA,MAAI,gBAAgB,MAApB,EAA4B;AACxB,IAAA,SAAS,GAAG,MAAM,CAAC,YAAD,CAAlB;;AAEA,QAAI,SAAS,KAAK,SAAlB,EAA6B;AACzB,UAAI,SAAS,KAAK,EAAlB,EAAsB;AAClB,cAAM,IAAI,KAAJ,CAAU,mDAAV,CAAN;AACH;;AAED,UAAI,CAAC,OAAD,EAAU,KAAV,EAAiB,UAAjB,EAA6B,UAA7B,EAAyC,OAAzC,CAAiD,SAAjD,MAAgE,CAAC,CAArE,EAAwE;AACpE,YAAI,CAAC,MAAM,CAAC,SAAD,CAAX,EAAwB;AACpB,gBAAM,IAAI,KAAJ,CAAU,sBAAmB,SAAnB,GAA4B,cAAtC,CAAN;AACH;;AAED,QAAA,SAAS,GAAG,MAAM,CAAC,SAAD,CAAlB;AACH;AACJ;AACJ,GAhBD,MAgBO,IAAI,kBAAkB,MAAtB,EAA8B;AACjC,IAAA,WAAW,GAAG,CAAC,MAAM,CAAC,cAAD,CAArB;;AAEA,QAAI,WAAW,CAAC,QAAZ,CAAqB,EAArB,MAA6B,MAAM,CAAC,cAAD,CAAvC,EAAyD;AACrD,YAAM,IAAI,KAAJ,CAAU,gCAA6B,MAAM,CAAC,cAAD,CAA7C,CAAN;AACH;AACJ,GANM,MAMA;AACH,UAAM,IAAI,KAAJ,CAAU,mDAAV,CAAN;AACH;;AAED,MAAI,EAAE,UAAU,MAAZ,CAAJ,EAAyB;AACrB,UAAM,IAAI,KAAJ,CAAU,qBAAV,CAAN;AACH;;AAED,MAAI,EAAE,YAAY,MAAd,CAAJ,EAA2B;AACvB,UAAM,IAAI,KAAJ,CAAU,uBAAV,CAAN;AACH;;AAED,MAAM,OAAO,GAAG,mBAAU,IAAV,CAAe,MAAM,CAAC,IAAtB,CAAhB;;AAEA,MAAI,OAAO,KAAK,IAAhB,EAAsB;AAClB,UAAM,IAAI,KAAJ,CAAU,qBAAkB,MAAM,CAAC,IAAzB,GAA6B,IAAvC,CAAN;AACH;;AAED,MAAI,MAAM,CAAC,KAAX,EAAkB;AACd,iBAAM,KAAN,GAAc,MAAM,CAAC,KAArB;AACH;;AAED,SAAO;AACH,IAAA,KAAK,EAAE,OAAO,CAAC,CAAD,CADX;AAEH,IAAA,IAAI,EAAE,OAAO,CAAC,CAAD,CAFV;AAGH,IAAA,SAAS,EAAA,SAHN;AAIH,IAAA,WAAW,EAAA,WAJR;AAKH,IAAA,MAAM,EAAE,MAAM,CAAC,MALZ;AAMH,IAAA,GAAG,EAAE,MAAM,CAAC,GANT;AAOH,IAAA,KAAK,EAAE,MAAM,CAAC,KAPX;AAQH,IAAA,WAAW,EAAE,MAAM,CAAC,WARjB;AASH,IAAA,KAAK,EAAE,MAAM,CAAC,KATX;AAUH,IAAA,KAAK,EAAE,MAAM,CAAC,KAAP,IAAgB;AAVpB,GAAP;AAYH;;AAEM,IAAM,cAAc,GAAG,kBAAkB,EAAzC;;;;;;;;;;AClED,SAAU,gBAAV,CAA2B,OAA3B,EAA0C;AAC5C,EAAA,OAAO,GAAG,OAAO,CAAC,OAAR,CAAgB,KAAhB,EAAuB,EAAvB,CAAV;AAEA,SAAO,kBAAkB,CAAC,MAAM,CAAC,IAAI,CAAC,OAAD,CAAL,CAAP,CAAzB;AACH;;;;;;;;;;;;;;;;;;;;ACND;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAM,UAAU,GAAG,yBAAnB;AACA,IAAM,0BAA0B,GAAG,0CAAnC;AACA,IAAM,qBAAqB,GAAG,qCAA9B;AACA,IAAM,kCAAkC,GAAG,8CAA3C;AAEO,IAAM,SAAS,GAAG,EAAlB;;AAIA,IAAM,aAAa,GAAiB,CAAC,IAAD,EAAO,IAAP,EAAa,OAAb,EAAsB,QAAtB,EAAgC,UAAhC,EAA4C,OAA5C,EAAqD,QAArD,EAA+D,MAA/D,CAApC;;AAEP,IAAI,KAAJ;AACA,IAAI,IAAJ;AACA,IAAM,MAAM,GAAG,QAAf;;AAEM,SAAU,cAAV,CAAyB,OAAzB,EAAkE;AACpE,EAAA,KAAK,GAAG,OAAO,CAAC,KAAhB;AACA,EAAA,IAAI,GAAG,OAAO,CAAC,IAAf;AACH;;AAED,SAAS,aAAT,CAAuB,WAAvB,EAA4C,IAA5C,EAA8D;AAC1D,EAAA,IAAI,GAAG,IAAI,IAAI,EAAf;AACA,EAAA,IAAI,CAAC,IAAL,GAAY,MAAZ;AACA,EAAA,IAAI,CAAC,KAAL,GAAa,UAAb;AAEA,MAAM,OAAO,GAAG,IAAI,OAAJ,CAAY,UAAU,GAAG,WAAzB,EAAsC,IAAtC,CAAhB;AAEA,EAAA,OAAO,CAAC,OAAR,CAAgB,GAAhB,CAAoB,QAApB,EAA8B,kCAA9B;;AAEA,MAAI,CAAC,YAAY,IAAZ,CAAiB,WAAjB,CAAD,IAAkC,aAAM,KAAN,KAAgB,IAAtD,EAA4D;AACxD,IAAA,OAAO,CAAC,OAAR,CAAgB,GAAhB,CAAoB,eAApB,EAAqC,WAAS,aAAM,KAApD;AACH;;AAED,SAAO,OAAP;AACH;;AAED,IAAM,SAAS,GAAG;AACd,EAAA,QAAQ,EAAE;AACN,IAAA,KAAK,EAAE,MAAM,CAAC,SADR;AAEN,IAAA,SAAS,EAAE,MAAM,CAAC,SAFZ;AAGN,IAAA,KAAK,EAAE;AAHD,GADI;AAMd,EAAA,MAAM,EAAE;AACJ,IAAA,KAAK,EAAE,MAAM,CAAC,SADV;AAEJ,IAAA,SAAS,EAAE,MAAM,CAAC,SAFd;AAGJ,IAAA,KAAK,EAAE;AAHH;AANM,CAAlB;;AAaA,SAAS,gBAAT,CAA0B,QAA1B,EAA4C;AACxC,MAAM,KAAK,GAAG,QAAQ,CAAC,OAAT,CAAiB,GAAjB,CAAqB,mBAArB,CAAd;AACA,MAAM,SAAS,GAAG,QAAQ,CAAC,OAAT,CAAiB,GAAjB,CAAqB,uBAArB,CAAlB;AACA,MAAM,KAAK,GAAG,QAAQ,CAAC,OAAT,CAAiB,GAAjB,CAAqB,mBAArB,CAAd;AAEA,MAAM,QAAQ,GAAG,aAAa,IAAb,CAAkB,QAAQ,CAAC,GAA3B,CAAjB;AACA,MAAM,IAAI,GAAG,QAAQ,GAAG,SAAS,CAAC,MAAb,GAAsB,SAAS,CAAC,QAArD;AAEA,EAAA,IAAI,CAAC,KAAL,GAAa,CAAC,KAAd;AACA,EAAA,IAAI,CAAC,SAAL,GAAiB,CAAC,SAAlB;AACA,EAAA,IAAI,CAAC,KAAL,GAAa,CAAC,KAAd;;AAEA,MAAI,QAAQ,CAAC,MAAT,KAAoB,GAApB,IAA2B,IAAI,CAAC,SAAL,KAAmB,CAAlD,EAAqD;AACjD,QAAM,SAAS,GAAG,IAAI,IAAJ,CAAS,CAAT,CAAlB;AAEA,IAAA,SAAS,CAAC,aAAV,CAAwB,IAAI,CAAC,KAA7B;AAEA,QAAM,IAAI,GAAG,IAAI,CAAC,KAAL,CAAW,CAAC,SAAS,CAAC,OAAV,KAAsB,IAAI,IAAJ,GAAW,OAAX,EAAvB,IAA+C,IAA/C,GAAsD,EAAjE,CAAb;AACA,QAAM,OAAO,GAAG,QAAQ,GAAG,YAAH,GAAkB,iBAA1C;AAGA,IAAA,OAAO,CAAC,IAAR,CAAa,6BAA2B,OAA3B,GAAkC,cAAlC,GAAiD,IAAjD,GAAqD,SAArD,IAA+D,IAAI,KAAK,CAAT,GAAa,EAAb,GAAkB,GAAjF,IAAoF,GAAjG;AACH;AACJ;;AAEK,SAAU,WAAV,CAAsB,QAAtB,EAAwC;AAC1C,MAAM,IAAI,GAAG,QAAQ,CAAC,OAAT,CAAiB,GAAjB,CAAqB,MAArB,CAAb;;AAEA,MAAI,IAAI,KAAK,IAAb,EAAmB;AACf,WAAO,CAAP;AACH;;AAED,MAAM,KAAK,GAAG,oCAAoC,IAApC,CAAyC,IAAzC,CAAd;;AAEA,MAAI,KAAK,KAAK,IAAd,EAAoB;AAChB,WAAO,CAAP;AACH;;AAED,SAAO,CAAC,KAAK,CAAC,CAAD,CAAb;AACH;;AAED,SAAS,WAAT,CAAqB,OAArB,EAAqC;AACjC,SAAO,KAAK,CAAC,OAAD,CAAL,CAAe,IAAf,CAAoB,UAAA,QAAA,EAAQ;AAC/B,QAAI,QAAQ,CAAC,MAAT,KAAoB,GAAxB,EAA6B;AACzB,mBAAM,KAAN,GAAc,IAAd;AACH;;AAED,QAAI,QAAQ,CAAC,MAAT,KAAoB,GAAxB,EAA6B;AACzB,MAAA,QAAQ,CAAC,IAAT,GAAgB,IAAhB,CAAqB,UAAA,IAAA,EAAI;AACrB,YAAI,IAAI,CAAC,OAAL,KAAiB,wCAArB,EAA+D;AAC3D,UAAA,MAAM,CAAC,aAAP,CAAqB,IAAI,WAAJ,CAAgB,eAAhB,CAArB;AACH;AACJ,OAJD;AAKH;;AAED,IAAA,gBAAgB,CAAC,QAAD,CAAhB;;AAEA,QAAI,OAAO,CAAC,MAAR,KAAmB,KAAnB,IAA4B,CAAC,GAAD,EAAM,GAAN,EAAW,OAAX,CAAmB,QAAQ,CAAC,MAA5B,MAAwC,CAAC,CAArE,IAA0E,OAAO,CAAC,OAAR,CAAgB,GAAhB,CAAoB,eAApB,CAA9E,EAAoH;AAChH,MAAA,OAAO,CAAC,OAAR,CAAgB,MAAhB,CAAuB,eAAvB;AAEA,aAAO,WAAW,CAAC,OAAD,CAAlB;AACH;;AAED,WAAO,QAAP;AACH,GAtBM,CAAP;AAuBH;;AAEK,SAAU,YAAV,CAA0B,IAA1B,EAAwC,IAAxC,EAAoD;AAAZ,MAAA,IAAA,KAAA,KAAA,CAAA,EAAA;AAAA,IAAA,IAAA,GAAA,KAAA;AAAY;;AACtD,MAAM,OAAO,GAAG,aAAa,CAAC,WAAS,KAAT,GAAc,GAAd,GAAkB,IAAlB,GAAsB,YAAtB,GAAmC,IAAnC,GAAuC,OAAvC,GAA+C,MAAhD,CAA7B;;AAEA,MAAI,IAAJ,EAAU;AACN,IAAA,OAAO,CAAC,OAAR,CAAgB,GAAhB,CAAoB,QAApB,EAA8B,qBAA9B;AACH;;AAED,SAAO,WAAW,CAAC,OAAD,CAAX,CAAqB,IAArB,CAAyD,UAAA,QAAA,EAAQ;AACpE,QAAI,QAAQ,CAAC,MAAT,KAAoB,GAAxB,EAA6B;AACzB,YAAM,IAAI,KAAJ,CAAU,YAAS,KAAT,GAAc,GAAd,GAAkB,IAAlB,GAAsB,kCAAtB,GAAuD,IAAvD,GAA2D,cAA3D,GAAwE,MAAxE,GAA8E,YAAxF,CAAN;AACH;;AAED,QAAI,CAAC,QAAQ,CAAC,EAAd,EAAkB;AACd,YAAM,IAAI,KAAJ,CAAU,oBAAkB,IAAlB,GAAsB,GAAhC,CAAN;AACH;;AAED,WAAO,IAAI,GAAG,QAAQ,CAAC,IAAT,EAAH,GAAqB,QAAQ,CAAC,IAAT,EAAhC;AACH,GAVM,EAUJ,IAVI,CAUI,UAAA,IAAA,EAAI;AACX,QAAI,IAAJ,EAAU;AACN,aAAO,IAAP;AACH;;AAEO,QAAA,OAAA,GAAA,IAAA,CAAA,OAAA;AACR,QAAM,OAAO,GAAG,gCAAiB,OAAjB,CAAhB;AAEA,WAAO,IAAI,CAAC,KAAL,CAAW,OAAX,CAAP;AACH,GAnBM,CAAP;AAoBH;;AAEK,SAAU,eAAV,CAA0B,IAA1B,EAAsC;AACxC,MAAM,CAAC,GAAG,OAAI,IAAJ,GAAQ,8BAAR,GAAsC,KAAtC,GAA2C,GAA3C,GAA+C,IAAzD;AACA,MAAM,OAAO,GAAG,aAAa,CAAC,qBAAmB,kBAAkB,CAAC,CAAD,CAArC,GAAwC,yBAAzC,CAA7B;AAEA,SAAO,WAAW,CAAC,OAAD,CAAX,CAAqB,IAArB,CAA+C,UAAA,QAAA,EAAQ;AAC1D,QAAI,CAAC,QAAQ,CAAC,EAAd,EAAkB;AACd,YAAM,IAAI,KAAJ,CAAU,kCAAV,CAAN;AACH;;AAED,WAAO,QAAQ,CAAC,IAAT,EAAP;AACH,GANM,EAMJ,IANI,CAMC,UAAA,OAAA,EAAO;AACX,QAAI,OAAO,CAAC,WAAR,KAAwB,CAA5B,EAA+B;AAC3B,aAAO,IAAP;AACH;;AAED,QAAI,OAAO,CAAC,WAAR,GAAsB,CAA1B,EAA6B;AAEzB,MAAA,OAAO,CAAC,IAAR,CAAa,6BAA0B,CAA1B,GAA2B,KAAxC;AACH;;AAED,IAAA,IAAI,GAAG,IAAI,CAAC,WAAL,EAAP;;AAEA,SAAqB,IAAA,EAAA,GAAA,CAAA,EAAA,EAAA,GAAA,OAAO,CAAC,KAA7B,EAAqB,EAAA,GAAA,EAAA,CAAA,MAArB,EAAqB,EAAA,EAArB,EAAoC;AAA/B,UAAM,MAAM,GAAA,EAAA,CAAA,EAAA,CAAZ;;AACD,UAAI,MAAM,CAAC,KAAP,CAAa,WAAb,GAA2B,OAA3B,CAAmC,IAAnC,MAA6C,CAAC,CAAlD,EAAqD;AACjD,eAAO,MAAP;AACH;AACJ;;AAGD,IAAA,OAAO,CAAC,IAAR,CAAa,wEAAqE,IAArE,GAAyE,yBAAtF;AAEA,WAAO,OAAO,CAAC,KAAR,CAAc,CAAd,CAAP;AACH,GA5BM,CAAP;AA6BH;;AAEK,SAAU,iBAAV,CAA4B,WAA5B,EAA+C;AACjD,MAAM,OAAO,GAAG,aAAa,CAAC,WAAS,KAAT,GAAc,GAAd,GAAkB,IAAlB,GAAsB,UAAtB,GAAiC,WAAlC,CAA7B;AAEA,SAAO,WAAW,CAAC,OAAD,CAAX,CAAqB,IAArB,CAAiC,UAAA,QAAA,EAAQ;AAC5C,QAAI,CAAC,QAAQ,CAAC,EAAd,EAAkB;AACd,YAAM,IAAI,KAAJ,CAAU,wCAAV,CAAN;AACH;;AAED,WAAO,QAAQ,CAAC,IAAT,EAAP;AACH,GANM,CAAP;AAOH;;AAED,SAAS,eAAT,CAAyB,WAAzB,EAA8C,IAA9C,EAA0D;AACtD,MAAM,GAAG,GAAG,WAAS,KAAT,GAAc,GAAd,GAAkB,IAAlB,GAAsB,UAAtB,GAAiC,WAAjC,GAA4C,iBAA5C,GAA8D,IAA9D,GAAkE,YAAlE,GAA+E,SAA3F;AACA,MAAM,OAAO,GAAG,aAAa,CAAC,GAAD,CAA7B;AACA,MAAM,MAAM,GAAM,0BAA0B,GAAA,GAA1B,GAA8B,kCAAhD;AAEA,EAAA,OAAO,CAAC,OAAR,CAAgB,GAAhB,CAAoB,QAApB,EAA8B,MAA9B;AAEA,SAAO,OAAP;AACH;;AAEK,SAAU,gBAAV,CAA2B,WAA3B,EAAgD,IAAhD,EAA4D;AAC9D,MAAM,OAAO,GAAG,eAAe,CAAC,WAAD,EAAc,IAAd,CAA/B;AAEA,SAAO,WAAW,CAAC,OAAD,CAAX,CAAqB,IAArB,CAA0B,UAAA,QAAA,EAAQ;AACrC,QAAI,CAAC,QAAQ,CAAC,EAAd,EAAkB;AACd,YAAM,IAAI,KAAJ,CAAU,0BAAV,CAAN;AACH;;AAED,WAAO,QAAQ,CAAC,IAAT,EAAP;AACH,GANM,CAAP;AAOH;;AAEK,SAAU,QAAV,GAAkB;AACpB,MAAI,aAAM,KAAN,KAAgB,IAApB,EAA0B;AACtB,WAAO,OAAO,CAAC,OAAR,CAAgB,IAAhB,CAAP;AACH;;AAED,SAAO,WAAW,CAAC,aAAa,CAAC,MAAD,CAAd,CAAX,CAAmC,IAAnC,CAAwC,UAAA,QAAA,EAAQ;AACnD,QAAI,QAAQ,CAAC,EAAb,EAAiB;AACb,aAAO,QAAQ,CAAC,IAAT,EAAP;AACH;;AAED,WAAO,IAAP;AACH,GANM,CAAP;AAOH;;AAEK,SAAU,WAAV,CAAsB,SAAtB,EAAyC,WAAzC,EAA8D,KAA9D,EAA6E,WAA7E,EAAkG,KAAlG,EAA+G;AACjH,MAAM,GAAG,GAAM,6BAAc,SAAd,GAAwB,KAAxB,GAA6B,GAA7B,GAAiC,IAAjC,GAAqC,SAArC,IAA+C,KAAK,GAAG,YAAU,kBAAkB,CAAC,KAAD,CAA/B,GAA2C,EAA/F,CAAf;AACA,MAAM,OAAO,GAAG,IAAI,OAAJ,CAAY,GAAZ,EAAiB;AAC7B,IAAA,MAAM,EAAE,MADqB;AAE7B,IAAA,IAAI,EAAE,IAAI,CAAC,SAAL,CAAe;AACjB,MAAA,KAAK,EAAE,SADU;AAEjB,MAAA,IAAI,EAAE,OAAK,KAAL,GAAU,MAAV,GAAiB,WAAjB,GAA4B,OAA5B,GAAoC,WAApC,GAA+C,IAA/C,GAAoD,WAApD,GAA+D;AAFpD,KAAf;AAFuB,GAAjB,CAAhB;AAQA,EAAA,OAAO,CAAC,OAAR,CAAgB,GAAhB,CAAoB,QAApB,EAA8B,kCAA9B;AACA,EAAA,OAAO,CAAC,OAAR,CAAgB,GAAhB,CAAoB,eAApB,EAAqC,WAAS,aAAM,KAApD;AAEA,SAAO,KAAK,CAAC,OAAD,CAAL,CAAe,IAAf,CAA2B,UAAA,QAAA,EAAQ;AACtC,QAAI,CAAC,QAAQ,CAAC,EAAd,EAAkB;AACd,YAAM,IAAI,KAAJ,CAAU,yCAAV,CAAN;AACH;;AAED,WAAO,QAAQ,CAAC,IAAT,EAAP;AACH,GANM,CAAP;AAOH;;AAEK,SAAU,WAAV,CAAsB,WAAtB,EAA2C,QAA3C,EAA2D;AAC7D,MAAM,GAAG,GAAG,WAAS,KAAT,GAAc,GAAd,GAAkB,IAAlB,GAAsB,UAAtB,GAAiC,WAAjC,GAA4C,WAAxD;AACA,MAAM,IAAI,GAAG,IAAI,CAAC,SAAL,CAAe;AAAE,IAAA,IAAI,EAAE;AAAR,GAAf,CAAb;AACA,MAAM,OAAO,GAAG,aAAa,CAAC,GAAD,EAAM;AAAE,IAAA,MAAM,EAAE,MAAV;AAAkB,IAAA,IAAI,EAAA;AAAtB,GAAN,CAA7B;AACA,MAAM,MAAM,GAAM,0BAA0B,GAAA,GAA1B,GAA8B,kCAAhD;AAEA,EAAA,OAAO,CAAC,OAAR,CAAgB,GAAhB,CAAoB,QAApB,EAA8B,MAA9B;AAEA,SAAO,WAAW,CAAC,OAAD,CAAX,CAAqB,IAArB,CAAwC,UAAA,QAAA,EAAQ;AACnD,QAAI,CAAC,QAAQ,CAAC,EAAd,EAAkB;AACd,YAAM,IAAI,KAAJ,CAAU,wBAAV,CAAN;AACH;;AAED,WAAO,QAAQ,CAAC,IAAT,EAAP;AACH,GANM,CAAP;AAOH;;AAEK,SAAgB,cAAhB,CAA+B,GAA/B,EAA4C,OAA5C,EAA+D;;;;;;;AACjE,UAAA,GAAG,GAAG,GAAG,CAAC,OAAJ,CAAY,UAAZ,EAAwB,EAAxB,CAAN;AAIM,UAAA,IAAI,GAAG,IAAI,CAAC,SAAL,CAAe;AAAE,YAAA,OAAO,EAAA;AAAT,WAAf,CAAP;AACA,UAAA,WAAW,GAAG,aAAa,CAAC,GAAD,EAAM;AAAE,YAAA,MAAM,EAAE,MAAV;AAAkB,YAAA,IAAI,EAAA;AAAtB,WAAN,CAA3B;AAEN,UAAA,WAAW,CAAC,OAAZ,CAAoB,GAApB,CAAwB,QAAxB,EAAkC,kCAAlC;AAEiB,iBAAA,CAAA,CAAA,EAAM,WAAW,CAAC,WAAD,CAAjB,CAAA;;;AAAX,UAAA,QAAQ,GAAG,EAAA,CAAA,IAAA,EAAX;eACqB,QAAQ,CAAC,IAAT,OAAA,CAAA,CAAA,EAAA,CAAA,CAAA;AAAc,iBAAA,CAAA,CAAA,EAAM,QAAQ,CAAC,IAAT,EAAN,CAAA;;;AAAA,UAAA,EAAA,GAAA,EAAA,CAAA,IAAA,EAAA;;;;AAAwB,UAAA,EAAA,GAAA,IAAA;;;;AAA3D,UAAA,QAAQ,GAAA,EAAR;;AAEN,cAAI,QAAQ,CAAC,MAAT,KAAoB,GAAxB,EAA6B;AACzB,mBAAA,CAAA,CAAA,EAAO;AAAE,cAAA,QAAQ,EAAA,QAAV;AAAY,cAAA,OAAO,EAAE;AAArB,aAAP,CAAA;AACH;;AAED,cAAI,QAAQ,CAAC,MAAT,KAAoB,GAAxB,EAA6B;AACzB,kBAAM,IAAI,KAAJ,CAAU,kEAAV,CAAN;AACH;;AAGK,UAAA,aAAa,GAAG,aAAa,CAAC,eAAa,QAAQ,CAAC,EAAvB,EAA6B;AAAE,YAAA,MAAM,EAAE;AAAV,WAA7B,CAA7B;AAEN,UAAA,aAAa,CAAC,OAAd,CAAsB,GAAtB,CAA0B,QAA1B,EAAoC,kCAApC;AAEA,iBAAA,CAAA,CAAA,EAAM,WAAW,CAAC,aAAD,CAAjB,CAAA;;;AAAA,UAAA,EAAA,CAAA,IAAA;;AAEA,iBAAA,CAAA,CAAA,EAAO;AAAE,YAAA,QAAQ,EAAA,QAAV;AAAY,YAAA,OAAO,EAAE;AAArB,WAAP,CAAA;;;;AACH;;AAEK,SAAU,cAAV,CAAyB,IAAzB,EAAqC;AACvC,MAAM,IAAI,GAAG,IAAI,CAAC,SAAL,CAAe;AAAE,IAAA,IAAI,EAAA,IAAN;AAAQ,IAAA,IAAI,EAAE,KAAd;AAAqB,IAAA,OAAO,EAAK,KAAK,GAAA,GAAL,GAAS;AAA1C,GAAf,CAAb;AAEA,SAAO,WAAW,CAAC,aAAa,CAAC,UAAD,EAAa;AAAE,IAAA,MAAM,EAAE,MAAV;AAAkB,IAAA,IAAI,EAAA;AAAtB,GAAb,CAAd,CAAX,CAAiE,IAAjE,CAAsE,UAAA,QAAA,EAAQ;AAAI,WAAA,QAAQ,CAAC,IAAT,EAAA;AAAe,GAAjG,CAAP;AACH;;;;;;;;AChTD,IAAM,UAAU,GAAG,CACf,IADe,EACT,QADS,EAEf,OAAO,EAFQ,EAEJ,QAFI,EAGf,OAAO,EAAP,GAAY,EAHG,EAGC,MAHD,EAIf,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAJF,EAIM,KAJN,EAKf,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAAjB,GAAsB,CALP,EAKU,MALV,EAMf,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAAjB,GAAsB,EANP,EAMW,OANX,CAAnB;AASA,IAAM,aAAa,GAA+B;AAAE,EAAA,KAAK,EAAE,OAAT;AAAkB,EAAA,GAAG,EAAE,SAAvB;AAAkC,EAAA,IAAI,EAAE;AAAxC,CAAlD;;AAEM,SAAU,OAAV,CAAkB,OAAlB,EAAmC,KAAnC,EAA8C;AAChD,MAAM,OAAO,GAAG,OAAO,GAAG,KAAK,CAAC,OAAN,EAA1B;;AAEA,MAAI,OAAO,GAAG,IAAd,EAAoB;AAChB,WAAO,UAAP;AACH;;AAED,MAAI,CAAC,GAAG,CAAR;;AAEA,SAAO,CAAC,GAAG,CAAJ,GAAQ,UAAU,CAAC,MAAnB,IAA6B,OAAO,GAAG,GAAV,GAAgB,UAAU,CAAC,CAAC,GAAG,CAAL,CAA9D,EAAuE;AACnE,IAAA,CAAC,IAAI,CAAL;AACH;;AAED,MAAM,OAAO,GAAG,UAAU,CAAC,CAAD,CAA1B;AACA,MAAM,IAAI,GAAG,UAAU,CAAC,CAAC,GAAG,CAAL,CAAvB;AACA,MAAM,KAAK,GAAG,IAAI,CAAC,KAAL,CAAW,OAAO,GAAG,OAArB,CAAd;;AAEA,MAAI,KAAK,GAAG,CAAR,IAAa,CAAC,KAAK,UAAU,CAAC,MAAX,GAAoB,CAA3C,EAA8C;AAC1C,WAAO,QAAM,KAAK,CAAC,kBAAN,CAAyB,SAAzB,EAAoC,aAApC,CAAb;AACH;;AAED,SAAO,KAAK,KAAK,CAAV,GAAc,CAAG,IAAI,KAAK,MAAT,GAAkB,IAAlB,GAAyB,GAA5B,IAA+B,GAA/B,GAAmC,IAAnC,GAAuC,MAArD,GAAiE,KAAK,GAAA,GAAL,GAAS,IAAT,GAAa,OAArF;AACH;;;;;;;;;AC9BD,IAAI,UAAJ;;AAEM,SAAU,cAAV,CAAyB,MAAzB,EAAuC;AACzC,EAAA,UAAU,GAAG,MAAb;AACA,EAAA,gBAAgB,CAAC,QAAD,EAAW,eAAX,CAAhB;AACA,EAAA,gBAAgB,CAAC,MAAD,EAAS,eAAT,CAAhB;AACH;;AAED,IAAI,UAAU,GAAG,CAAC,CAAlB;;AAEA,SAAS,OAAT,GAAgB;AACZ,MAAM,MAAM,GAAG,QAAQ,CAAC,IAAT,CAAc,YAA7B;;AAEA,MAAI,MAAM,KAAK,UAAf,EAA2B;AACvB;AACH;;AAED,EAAA,UAAU,GAAG,MAAb;AAEA,MAAM,OAAO,GAAkB;AAAE,IAAA,IAAI,EAAE,QAAR;AAAkB,IAAA,MAAM,EAAA;AAAxB,GAA/B;AAEA,EAAA,MAAM,CAAC,WAAP,CAAmB,OAAnB,EAA4B,UAA5B;AACH;;AAED,IAAI,WAAW,GAAG,CAAlB;;AAEM,SAAU,eAAV,GAAyB;AAC3B,MAAM,GAAG,GAAG,IAAI,CAAC,GAAL,EAAZ;;AAEA,MAAI,GAAG,GAAG,WAAN,GAAoB,EAAxB,EAA4B;AACxB,IAAA,WAAW,GAAG,GAAd;AACA,IAAA,UAAU,CAAC,OAAD,EAAU,EAAV,CAAV;AACH;AACJ;;;;;;;;;;;;;ACtCD;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEO,IAAM,aAAa,GAA+B;AACrD,QAAM,WAD+C;AAErD,QAAM,aAF+C;AAGrD,WAAS,OAH4C;AAIrD,YAAU,QAJ2C;AAKrD,cAAY,UALyC;AAMrD,WAAS,OAN4C;AAOrD,YAAU,QAP2C;AAQrD,UAAQ;AAR6C,CAAlD;;AAWA,IAAM,aAAa,GAA+B;AACrD,QAAM,IAD+C;AAErD,QAAM,IAF+C;AAGrD,WAAS,KAH4C;AAIrD,YAAU,KAJ2C;AAKrD,cAAY,IALyC;AAMrD,WAAS,IAN4C;AAOrD,YAAU,IAP2C;AAQrD,UAAQ;AAR6C,CAAlD;;;AAWD,SAAU,eAAV,CAA0B,GAA1B,EAAuC,QAAvC,EAA6D,QAA7D,EAAgF,KAAhF,EAA6F;AAC/F,SAAO,wIAKe,GALf,GAKkB,+FALlB,GAOU,QAPV,GAOkB,sCAPlB,GAQsB,aAAa,CAAC,QAAD,CARnC,GAQ6C,4CAR7C,GASmB,KATnB,GASwB,kBATxB,IAUG,QAAQ,GAAG,UAAH,GAAgB,EAV3B,IAU6B,aAV7B,GAWA,aAAa,CAAC,QAAD,CAXb,GAWuB,iBAX9B;AAaH;;AAEK,SAAU,eAAV,CAA0B,aAA1B,EAAgD;AAAtD,MAAA,KAAA,GAAA,IAAA;;AACI,MAAM,cAAc,GAAG,SAAjB,cAAiB,CAAO,KAAP,EAAmB;AAAA,WAAA,SAAA,CAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;;;;;;AAChC,YAAA,MAAM,GAAG,KAAK,CAAC,MAAN,YAAwB,WAAxB,IAAuC,KAAK,CAAC,MAAN,CAAa,OAAb,CAAqB,QAArB,CAAhD;;AAEN,gBAAI,CAAC,MAAL,EAAa;AACT,qBAAA,CAAA,CAAA,CAAA;AACH;;AAED,gBAAI,CAAC,MAAM,CAAC,YAAP,CAAoB,UAApB,CAAL,EAAsC;AAClC,qBAAA,CAAA,CAAA,CAAA;AACH;;AAED,YAAA,KAAK,CAAC,cAAN;;AAEA,gBAAI,CAAC,aAAL,EAAoB;AAChB,qBAAA,CAAA,CAAA,CAAA;AACH;;AAED,YAAA,MAAM,CAAC,QAAP,GAAkB,IAAlB;AAEM,YAAA,UAAU,GAAG,MAAM,CAAC,OAAP,CAAe,SAAf,CAAb;;AAEN,gBAAI,UAAJ,EAAgB;AACZ,cAAA,UAAU,CAAC,IAAX,GAAkB,KAAlB;AACH;;AAEK,YAAA,GAAG,GAAG,MAAM,CAAC,UAAb;AACA,YAAA,EAAE,GAAG,MAAM,CAAC,KAAZ;AACc,mBAAA,CAAA,CAAA,EAAM,4BAAe,GAAf,EAAoB,EAApB,CAAN,CAAA;;;AAAZ,YAAA,OAAO,GAAK,EAAA,CAAA,IAAA,EAAA,CAA6B,OAAzC;AACF,YAAA,QAAQ,GAAG,mCAAgC,GAAhC,GAAmC,cAAnC,GAAgD,EAAhD,GAAkD,sCAAlD,GAAuF,GAAvF,GAA0F,KAArG;AACA,YAAA,QAAQ,GAAG,KAAK,CAAC,IAAN,CAAW,QAAQ,CAAC,gBAAT,CAA0B,QAA1B,CAAX,CAAX;AACA,YAAA,KAAK,GAAG,OAAO,GAAG,CAAC,CAAJ,GAAQ,CAAvB;;AAEN,iBAAA,EAAA,GAAA,CAAA,EAAsB,UAAA,GAAA,QAAtB,EAAsB,EAAA,GAAA,UAAA,CAAA,MAAtB,EAAsB,EAAA,EAAtB,EAAgC;AAArB,cAAA,OAAO,GAAA,UAAA,CAAA,EAAA,CAAP;AACP,cAAA,OAAO,CAAC,YAAR,CAAqB,gBAArB,EAAuC,CAAC,QAAQ,CAAC,OAAO,CAAC,YAAR,CAAqB,gBAArB,CAAD,EAA0C,EAA1C,CAAR,GAAwD,KAAzD,EAAgE,QAAhE,EAAvC;AACH;;AAED,YAAA,MAAM,CAAC,QAAP,GAAkB,KAAlB;AACA;;;;KArCsC,CAAA;AAsCzC,GAtCD;;AAuCA,EAAA,gBAAgB,CAAC,OAAD,EAAU,cAAV,EAA0B,IAA1B,CAAhB;AACH;;AAEK,SAAU,oBAAV,CAA+B,GAA/B,EAA4C,KAA5C,EAAqE;AACvE,MAAM,QAAQ,GAAG,KAAK,KAAK,QAAV,GAAqB,uCAArB,GAA+D,WAAhF;AACA,MAAM,cAAc,GAAG,KAAK,KAAK,QAAV,GAAqB,EAArB,GAA0B,4BAAjD;;AACA,MAAM,gBAAgB,GAAG,SAAnB,gBAAmB,CAAC,EAAD,EAAe;AAAK,WAAA,eAAe,CAAC,GAAD,EAAM,EAAN,EAAU,KAAV,EAAiB,CAAjB,CAAf,IAAqC,wDAAkD,aAAa,CAAC,EAAD,CAA/D,GAAmE,SAAxG,CAAA;AAAiH,GAA9J;;AAEA,SAAO,4GAEY,KAAK,KAAK,QAAV,GAAqB,eAArB,GAAuC,EAFnD,IAEqD,GAFrD,GAEyD,eAFzD,GAEwE,yDAFxE,GAG+B,QAH/B,GAGuC,qDAHvC,GAIoC,cAJpC,GAIkD,kMAJlD,GAOe,sBAAc,KAAd,CAAoB,CAApB,EAAuB,CAAvB,EAA0B,GAA1B,CAA8B,gBAA9B,EAAgD,IAAhD,CAAqD,EAArD,CAPf,GAOuE,sGAPvE,GAUe,sBAAc,KAAd,CAAoB,CAApB,EAAuB,GAAvB,CAA2B,gBAA3B,EAA6C,IAA7C,CAAkD,EAAlD,CAVf,GAUoE,qGAV3E;AAgBH;;AAEK,SAAU,wBAAV,CAAmC,KAAnC,EAA4D;AAC9D,MAAM,QAAQ,GAAG,KAAK,KAAK,QAAV,GAAqB,uCAArB,GAA+D,WAAhF;AACA,MAAM,cAAc,GAAG,KAAK,KAAK,QAAV,GAAqB,EAArB,GAA0B,4BAAjD;AAEA,SAAO,yIAEwC,eAFxC,GAEuD,yDAFvD,GAG+B,QAH/B,GAGuC,oDAHvC,GAImC,cAJnC,GAIiD,oFAJjD,GAK0B,wBAAY,+BAAe,GAA3B,CAL1B,GAKyD,mIALhE;AAUH;;AAGD,IAAM,eAAe,GAAG,wnCAAxB;;;;;;;;;;AC9HA;;AACA;;AACA;;AACA;;AAEA,IAAM,UAAU,GAAG,WAAnB;AACA,IAAM,mBAAmB,GAA6C;AAClE,EAAA,YAAY,EAAE,cADoD;AAElE,EAAA,WAAW,EAAE,aAFqD;AAGlE,EAAA,MAAM,EAAE,QAH0D;AAIlE,EAAA,KAAK,EAAE,OAJ2D;AAKlE,EAAA,sBAAsB,EAAE,wBAL0C;AAMlE,EAAA,WAAW,EAAE,aANqD;AAOlE,EAAA,IAAI,EAAE;AAP4D,CAAtE;;AAUA,IAAA,gBAAA,GAAA,YAAA;AAGI,WAAA,gBAAA,CACW,OADX,EAEY,WAFZ,EAGI,MAHJ,EAGmB;AAFR,SAAA,OAAA,GAAA,OAAA;AACC,SAAA,WAAA,GAAA,WAAA;AAGA,QAAA,IAAA,GAAA,OAAA,CAAA,IAAA;AAAA,QAAM,QAAA,GAAA,OAAA,CAAA,QAAN;AAAA,QAAgB,UAAA,GAAA,OAAA,CAAA,UAAhB;AAAA,QAA4B,SAAA,GAAA,OAAA,CAAA,SAA5B;AAAA,QAAuC,kBAAA,GAAA,OAAA,CAAA,kBAAvC;AAAA,QAA2D,SAAA,GAAA,OAAA,CAAA,SAA3D;AAER,SAAK,OAAL,GAAe,QAAQ,CAAC,aAAT,CAAuB,SAAvB,CAAf;AACA,SAAK,OAAL,CAAa,SAAb,CAAuB,GAAvB,CAA2B,kBAA3B;;AAEA,QAAI,IAAI,CAAC,KAAL,KAAe,WAAnB,EAAgC;AAC5B,WAAK,OAAL,CAAa,SAAb,CAAuB,GAAvB,CAA2B,cAA3B;AACH;;AAED,QAAM,WAAW,GAAG,mBAAmB,CAAC,kBAAD,CAAvC;;AACA,QAAM,aAAa,GAAG,sBAAc,MAAd,CAAqB,UAAC,GAAD,EAAM,EAAN,EAAQ;AAAK,aAAA,GAAG,GAAG,SAAS,CAAC,EAAD,CAAf;AAAmB,KAArD,EAAuD,CAAvD,CAAtB;;AACA,QAAI,mBAAmB,GAAG,EAA1B;AACA,QAAI,mBAAmB,GAAG,EAA1B;;AAEA,QAAI,CAAC,MAAL,EAAa;AACT,UAAI,WAAJ,EAAiB;AACb,QAAA,mBAAmB,GAAG,qCAAqB,OAAO,CAAC,SAAR,CAAkB,GAAvC,EAA4C,OAA5C,CAAtB;AACA,QAAA,mBAAmB,GAAG,qCAAqB,OAAO,CAAC,SAAR,CAAkB,GAAvC,EAA4C,QAA5C,CAAtB;AACH,OAHD,MAGO;AACH,QAAA,mBAAmB,GAAG,yCAAyB,OAAzB,CAAtB;AACA,QAAA,mBAAmB,GAAG,yCAAyB,QAAzB,CAAtB;AACH;AACJ;;AAED,SAAK,OAAL,CAAa,SAAb,GAAyB,8CACK,IAAI,CAAC,QADV,GACkB,kDADlB,GAC+D,IAAI,CAAC,UADpE,GACiF,UADjF,GAC2F,uCAD3F,GAC6H,IAAI,CAAC,KADlI,GACuI,4MADvI,GAKoB,IAAI,CAAC,QALzB,GAKiC,+BALjC,GAK8D,IAAI,CAAC,KALnE,GAKwE,0GALxE,GAOoB,QAPpB,GAO4B,uBAP5B,GAOiD,sBAAQ,IAAI,CAAC,GAAL,EAAR,EAAoB,IAAI,IAAJ,CAAS,UAAT,CAApB,CAPjD,GAO0F,kHAP1F,IAUP,WAAW,GAAG,8CAA0C,WAA1C,GAAqD,SAAxD,GAAoE,EAVxE,IAU0E,4BAV1E,GAWP,mBAXO,GAWY,uJAXZ,GAeX,SAfW,GAeF,2FAfE,GAiB6B,aAjB7B,GAiB0C,oBAjB1C,GAiB6D,SAAS,CAAC,GAjBvE,GAiB0E,mHAjB1E,GAmBP,sBAAc,GAAd,CAAkB,UAAA,EAAA,EAAE;AAAI,aAAA,gCAAgB,SAAS,CAAC,GAA1B,EAA+B,EAA/B,EAAmC,CAAC,WAAD,IAAgB,MAAnD,EAA2D,SAAS,CAAC,EAAD,CAApE,CAAA;AAAyE,KAAjG,EAAmG,IAAnG,CAAwG,EAAxG,CAnBO,GAmBoG,qDAnBpG,GAqBX,mBArBW,GAqBQ,wDArBjC;AA0BA,QAAM,YAAY,GAAG,KAAK,OAAL,CAAa,aAAb,CAA2B,gBAA3B,CAArB;AACA,QAAM,WAAW,GAAG,YAAY,CAAC,aAAb,CAA2B,wBAA3B,CAApB;;AAEA,QAAI,WAAJ,EAAiB;AACb,UAAM,YAAU,GAAG,YAAY,CAAC,aAAb,CAA2B,qBAA3B,CAAnB;;AAEA,MAAA,WAAW,CAAC,OAAZ,GAAsB,UAAA,KAAA,EAAK;AACvB,QAAA,KAAK,CAAC,cAAN;AACA,QAAA,YAAU,CAAC,SAAX,CAAqB,MAArB,CAA4B,UAA5B;AACH,OAHD;AAIH;;AAED,IAAA,uBAAuB,CAAC,YAAD,CAAvB;AACH;;AAEM,EAAA,gBAAA,CAAA,SAAA,CAAA,cAAA,GAAP,UAAsB,WAAtB,EAAgD;AAC5C,QAAI,KAAK,WAAL,KAAqB,WAAzB,EAAsC;AAClC;AACH;;AAED,SAAK,WAAL,GAAmB,WAAnB;;AAEA,QAAI,KAAK,OAAL,CAAa,IAAb,CAAkB,KAAlB,KAA4B,KAAK,WAArC,EAAkD;AAC9C,WAAK,OAAL,CAAa,SAAb,CAAuB,GAAvB,CAA2B,cAA3B;AACH,KAFD,MAEO;AACH,WAAK,OAAL,CAAa,SAAb,CAAuB,MAAvB,CAA8B,cAA9B;AACH;AACJ,GAZM;;AAaX,SAAA,gBAAA;AAtFA,CAAA,EAAA;;;;AAwFM,SAAU,uBAAV,CAAkC,YAAlC,EAAuD;AACzD,EAAA,KAAK,CAAC,IAAN,CAAW,YAAY,CAAC,gBAAb,CAAiD,gCAAjD,CAAX,EACK,OADL,CACa,UAAA,CAAA,EAAC;AAAM,IAAA,CAAC,CAAC,MAAF,GAAW,MAAX;AAAmB,IAAA,CAAC,CAAC,GAAF,GAAQ,qBAAR;AAAgC,GADvE;AAEA,EAAA,KAAK,CAAC,IAAN,CAAW,YAAY,CAAC,gBAAb,CAAgD,KAAhD,CAAX,EACK,OADL,CACa,UAAA,GAAA,EAAG;AAAI,WAAA,GAAG,CAAC,MAAJ,GAAa,wBAAb;AAA4B,GADhD;AAEA,EAAA,KAAK,CAAC,IAAN,CAAW,YAAY,CAAC,gBAAb,CAAiD,oBAAjD,CAAX,EACK,OADL,CACa,UAAA,CAAA,EAAC;AAAI,WAAA,CAAC,CAAC,IAAF,GAAS,uBAAuB,CAAC,CAAC,QAAlC;AAA0C,GAD5D;AAEH;;;;;;;;;AC9GD;;AACA;;AAEA,IAAA,iBAAA,GAAA,YAAA;AAOI,WAAA,iBAAA,CACY,IADZ,EAEY,KAFZ,EAE+B;AADnB,SAAA,IAAA,GAAA,IAAA;AACA,SAAA,KAAA,GAAA,KAAA;AAPK,SAAA,QAAA,GAA+B,EAA/B;AAGT,SAAA,KAAA,GAAgB,CAAhB;AAMJ,SAAK,OAAL,GAAe,QAAQ,CAAC,aAAT,CAAuB,MAAvB,CAAf;AACA,SAAK,OAAL,CAAa,SAAb,CAAuB,GAAvB,CAA2B,UAA3B;AACA,SAAK,OAAL,CAAa,SAAb,GAAyB,qQAAzB;AAMA,SAAK,WAAL,GAAmB,KAAK,OAAL,CAAa,iBAAb,CAAgC,iBAAnD;AACA,SAAK,MAAL,GAAc,QAAQ,CAAC,aAAT,CAAuB,QAAvB,CAAd;AACA,SAAK,OAAL,CAAa,WAAb,CAAyB,KAAK,MAA9B;AACA,SAAK,QAAL,CAAc,KAAK,KAAnB;AACA,SAAK,WAAL;AACH;;AAEM,EAAA,iBAAA,CAAA,SAAA,CAAA,OAAA,GAAP,UAAe,IAAf,EAAgC;AAC5B,SAAK,IAAL,GAAY,IAAZ;AAEA,QAAM,KAAK,GAAG,IAAI,GAAG,IAAI,CAAC,KAAR,GAAgB,IAAlC;;AAEA,SAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,KAAK,QAAL,CAAc,MAAlC,EAA0C,CAAC,EAA3C,EAA+C;AAC3C,WAAK,QAAL,CAAc,CAAd,EAAiB,cAAjB,CAAgC,KAAhC;AACH;;AAED;AACH,GAVM;;AAYA,EAAA,iBAAA,CAAA,SAAA,CAAA,QAAA,GAAP,UAAgB,KAAhB,EAAmC;AAC/B,SAAK,KAAL,GAAa,KAAb;;AAEA,QAAI,KAAJ,EAAW;AACP,WAAK,KAAL,GAAa,KAAK,CAAC,QAAnB;AACA,WAAK,WAAL,CAAiB,IAAjB,GAAwB,KAAK,CAAC,QAA9B;AACA,WAAK,WAAL;AACH,KAJD,MAIO;AACH,WAAK,WAAL,CAAiB,eAAjB,CAAiC,MAAjC;AACH;AACJ,GAVM;;AAYA,EAAA,iBAAA,CAAA,SAAA,CAAA,aAAA,GAAP,UAAqB,OAArB,EAA4C,cAA5C,EAAmE;AAC/D,QAAM,SAAS,GAAG,IAAI,kCAAJ,CAAqB,OAArB,EAA8B,KAAK,IAAL,GAAY,KAAK,IAAL,CAAU,KAAtB,GAA8B,IAA5D,EAAkE,KAAK,KAAL,CAAY,MAA9E,CAAlB;AACA,QAAM,KAAK,GAAG,KAAK,QAAL,CAAc,SAAd,CAAwB,UAAA,CAAA,EAAC;AAAI,aAAA,CAAC,CAAC,OAAF,CAAU,EAAV,IAAgB,OAAO,CAAC,EAAxB;AAA0B,KAAvD,CAAd;;AAEA,QAAI,KAAK,KAAK,CAAC,CAAf,EAAkB;AACd,WAAK,QAAL,CAAc,IAAd,CAAmB,SAAnB;AACA,WAAK,OAAL,CAAa,YAAb,CAA0B,SAAS,CAAC,OAApC,EAA6C,KAAK,MAAlD;AACH,KAHD,MAGO;AACH,UAAM,IAAI,GAAG,KAAK,QAAL,CAAc,KAAd,CAAb;AACA,UAAM,MAAM,GAAG,IAAI,CAAC,OAAL,CAAa,EAAb,KAAoB,OAAO,CAAC,EAA3C;AAEA,WAAK,OAAL,CAAa,YAAb,CAA0B,SAAS,CAAC,OAApC,EAA6C,IAAI,CAAC,OAAlD;AACA,WAAK,QAAL,CAAc,MAAd,CAAqB,KAArB,EAA4B,MAAM,GAAG,CAAH,GAAO,CAAzC,EAA4C,SAA5C;;AAEA,UAAI,MAAJ,EAAY;AACR,QAAA,IAAI,CAAC,OAAL,CAAa,MAAb;AACH;AACJ;;AAED,QAAI,cAAJ,EAAoB;AAChB,WAAK,KAAL;AACA,WAAK,WAAL;AACH;;AAED;AACH,GAzBM;;AA2BA,EAAA,iBAAA,CAAA,SAAA,CAAA,gBAAA,GAAP,UAAwB,WAAxB,EAAmD,KAAnD,EAAkE,QAAlE,EAAsF;AAC1E,QAAA,kBAAA,GAAA,KAAA,QAAA,CAAA,IAAA,CAAA,UAAA,CAAA,EAAA;AAAA,aAAA,CAAA,CAAA,OAAA,CAAA,EAAA,IAAA,WAAA,CAAA,EAAA;AAAA,KAAA,EAAA,OAAA;AAER,IAAA,kBAAkB,CAAC,kBAAnB,CAAsC,UAAtC,EAAkD,gMAIpC,KAJoC,GAI/B,4HAJnB;AAUA,QAAM,OAAO,GAAG,kBAAkB,CAAC,kBAAnC;AACA,QAAM,MAAM,GAAG,OAAO,CAAC,gBAAvB;AACA,QAAM,UAAU,GAAG,MAAM,CAAC,gBAA1B;AAEA,IAAA,MAAM,CAAC,OAAP,GAAiB,QAAjB;AAEA,WAAO;AACH,MAAA,OAAO,EAAA,mBAAA;AACH,QAAA,UAAU,CAAC,WAAX,GAAyB,YAAzB;AACA,QAAA,MAAM,CAAC,QAAP,GAAkB,IAAlB;AACH,OAJE;AAKH,MAAA,MAAM,EAAA,kBAAA;AACF,QAAA,MAAM,CAAC,OAAP,GAAiB,IAAjB;AACA,QAAA,OAAO,CAAC,MAAR;AACH;AARE,KAAP;AAUH,GA7BM;;AA+BC,EAAA,iBAAA,CAAA,SAAA,CAAA,WAAA,GAAR,YAAA;AACI,SAAK,WAAL,CAAiB,WAAjB,GAAkC,KAAK,KAAL,GAAU,UAAV,IAAqB,KAAK,KAAL,KAAe,CAAf,GAAmB,EAAnB,GAAwB,GAA7C,CAAlC;AACH,GAFO;;AAGZ,SAAA,iBAAA;AA/GA,CAAA,EAAA;;;;;;;;;;;ACJA;;AACA;;AAMA,IAAI,OAAJ;;AAEM,SAAU,aAAV,GAAuB;AACzB,MAAI,CAAC,OAAL,EAAc;AACV,IAAA,OAAO,GAAG,0BAAyB,cAAzB,EAAyC,IAAzC,CACN,UAAA,IAAA,EAAI;AACA,UAAI,CAAC,KAAK,CAAC,OAAN,CAAc,IAAI,CAAC,OAAnB,CAAL,EAAkC;AAC9B,QAAA,IAAI,CAAC,OAAL,GAAe,EAAf;AACH;;AACD,aAAO,IAAP;AACH,KANK,EAON,YAAA;AAAM,aAAC;AACH,QAAA,OAAO,EAAE,CAAC,+BAAe,MAAhB;AADN,OAAD;AAEJ,KATI,CAAV;AAWH;;AAED,SAAO,OAAP;AACH;;;;;;;;;ACzBD;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,IAAM,eAAe,GAAG,gZAAxB;AAEA,IAAM,kBAAkB,GAAG,+BAA6B,IAAI,CAAC,eAAD,CAA5D;AAEA,IAAM,gBAAgB,GAAG,oBAAzB;;AAEA,IAAA,mBAAA,GAAA,YAAA;AAcI,WAAA,mBAAA,CACY,IADZ,EAEqB,MAFrB,EAEgE;AAFhE,QAAA,KAAA,GAAA,IAAA;;AACY,SAAA,IAAA,GAAA,IAAA;AACS,SAAA,MAAA,GAAA,MAAA;AALb,SAAA,UAAA,GAAa,KAAb;AACA,SAAA,aAAA,GAAgB,CAAhB;;AAiFA,SAAA,WAAA,GAAc,YAAA;AAClB;AAEA,UAAM,IAAI,GAAG,KAAI,CAAC,QAAL,CAAc,KAA3B;AACA,UAAM,YAAY,GAAG,QAAQ,IAAR,CAAa,IAAb,CAArB;AAEA,MAAA,KAAI,CAAC,YAAL,CAAkB,QAAlB,GAA6B,YAA7B;;AAEA,UAAI,KAAI,CAAC,QAAL,CAAc,YAAd,GAA6B,GAA7B,IAAoC,KAAI,CAAC,QAAL,CAAc,YAAd,GAA6B,KAAI,CAAC,QAAL,CAAc,YAAnF,EAAiG;AAC7F,QAAA,KAAI,CAAC,QAAL,CAAc,KAAd,CAAoB,MAApB,GAAgC,KAAI,CAAC,QAAL,CAAc,YAAd,GAA0B,IAA1D;AACA;AACH;;AAED,MAAA,YAAY,CAAC,KAAI,CAAC,aAAN,CAAZ;;AAEA,UAAI,YAAJ,EAAkB;AACd,QAAA,KAAI,CAAC,OAAL,CAAa,WAAb,GAA2B,gBAA3B;AACH,OAFD,MAEO;AACH,QAAA,KAAI,CAAC,OAAL,CAAa,WAAb,GAA2B,oBAA3B;AACA,QAAA,KAAI,CAAC,aAAL,GAAqB,UAAU,CAC3B,YAAA;AAAM,iBAAA,4BAAe,IAAf,EAAqB,IAArB,CAA0B,UAAA,IAAA,EAAI;AAAI,mBAAA,KAAI,CAAC,OAAL,CAAa,SAAb,GAAyB,IAAzB;AAA6B,WAA/D,EACD,IADC,CACI,YAAA;AAAM,mBAAA,+CAAwB,KAAI,CAAC,OAA7B,CAAA;AAAqC,WAD/C,EAED,IAFC,CAEI,wBAFJ,CAAA;AAEoB,SAHC,EAI3B,GAJ2B,CAA/B;AAKH;AACJ,KAzBO;;AA2BA,SAAA,YAAA,GAAe,UAAO,KAAP,EAAmB;AAAA,aAAA,SAAA,CAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;;;;AACtC,cAAA,KAAK,CAAC,cAAN;;AAEA,kBAAI,KAAK,UAAT,EAAqB;AACjB,uBAAA,CAAA,CAAA,CAAA;AACH;;AAED,mBAAK,UAAL,GAAkB,IAAlB;AACA,mBAAK,QAAL,CAAc,QAAd,GAAyB,IAAzB;AACA,mBAAK,YAAL,CAAkB,QAAlB,GAA6B,IAA7B;AACA,qBAAA,CAAA,CAAA,EAAM,KAAK,MAAL,CAAY,KAAK,QAAL,CAAc,KAA1B,EAAiC,KAAjC,CAAuC,YAAA;AAAM,uBAAA,CAAA;AAAC,eAA9C,CAAN,CAAA;;;AAAA,cAAA,EAAA,CAAA,IAAA;;AACA,mBAAK,UAAL,GAAkB,KAAlB;AACA,mBAAK,QAAL,CAAc,QAAd,GAAyB,CAAC,KAAK,IAA/B;AACA,mBAAK,QAAL,CAAc,KAAd,GAAsB,EAAtB;AACA,mBAAK,YAAL,CAAkB,QAAlB,GAA6B,KAA7B;AACA,mBAAK,WAAL,CAAgB,QAAA,CAAA,QAAA,CAAA,EAAA,EAAM,KAAN,CAAA,EAAW;AAAE,gBAAA,MAAM,EAAE,KAAK,IAAL,CAAU,aAAV,CAAwB,uBAAxB;AAAV,eAAX,CAAhB;AACA,mBAAK,OAAL,CAAa,WAAb,GAA2B,gBAA3B;;;;OAhBsC,CAAA;AAiBzC,KAjBO;;AAmBA,SAAA,WAAA,GAAc,UAAC,EAAD,EAAkB;UAAf,MAAA,GAAA,EAAA,CAAA;;AACrB,UAAI,EAAE,MAAM,YAAY,iBAApB,KAA0C,CAAC,MAAM,CAAC,SAAP,CAAiB,QAAjB,CAA0B,YAA1B,CAA/C,EAAwF;AACpF;AACH;;AAED,UAAI,MAAM,CAAC,YAAP,CAAoB,eAApB,MAAyC,MAA7C,EAAqD;AACjD;AACH;;AAED,MAAA,KAAI,CAAC,IAAL,CAAU,aAAV,CAAwB,mCAAxB,EAA8D,YAA9D,CAA2E,eAA3E,EAA4F,OAA5F;;AACA,MAAA,MAAM,CAAC,YAAP,CAAoB,eAApB,EAAqC,MAArC;AACA,UAAM,SAAS,GAAG,MAAM,CAAC,SAAP,CAAiB,QAAjB,CAA0B,aAA1B,CAAlB;AACA,MAAA,KAAI,CAAC,QAAL,CAAc,KAAd,CAAoB,OAApB,GAA8B,SAAS,GAAG,MAAH,GAAY,EAAnD;AACA,MAAA,KAAI,CAAC,OAAL,CAAa,KAAb,CAAmB,OAAnB,GAA6B,SAAS,GAAG,EAAH,GAAQ,MAA9C;AACA;AACH,KAfO;;AAiBA,SAAA,aAAA,GAAgB,UAAC,EAAD,EAAkC;UAA/B,KAAA,GAAA,EAAA,CAAA;UAAO,OAAA,GAAA,EAAA,CAAA;;AAC9B,UAAI,KAAK,KAAK,EAAV,IAAgB,OAAhB,IAA2B,CAAC,KAAI,CAAC,YAAL,CAAkB,QAAlD,EAA4D;AACxD,QAAA,KAAI,CAAC,IAAL,CAAU,aAAV,CAAwB,IAAI,WAAJ,CAAgB,QAAhB,CAAxB;AACH;AACJ,KAJO;;AA1IJ,SAAK,OAAL,GAAe,QAAQ,CAAC,aAAT,CAAuB,SAAvB,CAAf;AACA,SAAK,OAAL,CAAa,SAAb,CAAuB,GAAvB,CAA2B,kBAA3B;AAEA,SAAK,OAAL,CAAa,SAAb,GAAyB,+1BAWsC,gBAXtC,GAWsD,kiCAXtD,GAyBsB,wBAAY,+BAAK,GAAjB,CAzBtB,GAyB2C,qGAzBpE;AA8BA,SAAK,YAAL,GAAoB,KAAK,OAAL,CAAa,iBAAjC;AACA,SAAK,MAAL,GAAc,KAAK,YAAL,CAAkB,iBAAhC;AACA,SAAK,IAAL,GAAY,KAAK,YAAL,CAAkB,kBAA9B;AACA,SAAK,QAAL,GAAgB,KAAK,IAAL,CAAW,iBAAX,CAA8B,kBAA9B,CAAkD,iBAAlE;AACA,SAAK,OAAL,GAAe,KAAK,IAAL,CAAW,iBAAX,CAA8B,kBAA9B,CAAkD,gBAAjE;AACA,SAAK,YAAL,GAAoB,KAAK,IAAL,CAAW,gBAAX,CAA6B,gBAAjD;AACA,SAAK,YAAL,GAAoB,KAAK,YAAL,CAAkB,sBAAtC;AAEA,SAAK,OAAL,CAAa,IAAb;AACA,SAAK,YAAL,CAAkB,QAAlB,GAA6B,IAA7B;AAEA,SAAK,QAAL,CAAc,gBAAd,CAA+B,OAA/B,EAAwC,KAAK,WAA7C;AACA,SAAK,IAAL,CAAU,gBAAV,CAA2B,QAA3B,EAAqC,KAAK,YAA1C;AACA,SAAK,IAAL,CAAU,gBAAV,CAA2B,OAA3B,EAAoC,KAAK,WAAzC;AACA,SAAK,IAAL,CAAU,gBAAV,CAA2B,SAA3B,EAAsC,KAAK,aAA3C;AACA,IAAA,oBAAoB,CAAC,KAAK,QAAN,CAApB;AACH;;AAEM,EAAA,mBAAA,CAAA,SAAA,CAAA,OAAA,GAAP,UAAe,IAAf,EAAgC;AAC5B,SAAK,IAAL,GAAY,IAAZ;AACA,SAAK,YAAL,CAAkB,MAAlB,GAA2B,CAAC,IAA5B;AACA,SAAK,YAAL,CAAkB,MAAlB,GAA2B,CAAC,CAAC,IAA7B;;AAEA,QAAI,IAAJ,EAAU;AACN,WAAK,YAAL,CAAkB,IAAlB,GAAyB,IAAI,CAAC,QAA9B;AACA,WAAK,MAAL,CAAY,GAAZ,GAAkB,MAAM,IAAI,CAAC,KAA7B;AACA,WAAK,MAAL,CAAY,GAAZ,GAAkB,IAAI,CAAC,UAAL,GAAkB,WAApC;AACA,WAAK,QAAL,CAAc,QAAd,GAAyB,KAAzB;AACA,WAAK,QAAL,CAAc,WAAd,GAA4B,iBAA5B;AACH,KAND,MAMO;AACH,WAAK,YAAL,CAAkB,eAAlB,CAAkC,MAAlC;AACA,WAAK,MAAL,CAAY,GAAZ,GAAkB,YAAlB;AACA,WAAK,MAAL,CAAY,GAAZ,GAAkB,kBAAlB;AACA,WAAK,QAAL,CAAc,QAAd,GAAyB,IAAzB;AACA,WAAK,QAAL,CAAc,WAAd,GAA4B,oBAA5B;AACH;AACJ,GAlBM;;AAoBA,EAAA,mBAAA,CAAA,SAAA,CAAA,KAAA,GAAP,YAAA;AACI,SAAK,QAAL,CAAc,KAAd,GAAsB,EAAtB;AACH,GAFM;;AAwEX,SAAA,mBAAA;AAjKA,CAAA,EAAA;;;;AAmKA,SAAS,oBAAT,CAA8B,QAA9B,EAA2D;AACvD,MAAM,YAAY,GAAG,SAAf,YAAe,GAAA;AACjB,IAAA,mBAAmB,CAAC,WAAD,EAAc,wBAAd,CAAnB;AACA,IAAA,mBAAmB,CAAC,SAAD,EAAY,YAAZ,CAAnB;AACH,GAHD;;AAIA,MAAM,KAAK,GAAG,SAAR,KAAQ,GAAA;AACV,IAAA,gBAAgB,CAAC,WAAD,EAAc,wBAAd,CAAhB;AACA,IAAA,gBAAgB,CAAC,SAAD,EAAY,YAAZ,CAAhB;AACH,GAHD;;AAIA,EAAA,QAAQ,CAAC,gBAAT,CAA0B,WAA1B,EAAuC,KAAvC;AACH;;;;;;;;;AC3LK,SAAU,SAAV,CAAoB,KAApB,EAAmC,MAAnC,EAAiD;AACnD,SAAO,IAAI,OAAJ,CAAY,UAAA,OAAA,EAAO;AACtB,QAAM,IAAI,GAAG,QAAQ,CAAC,aAAT,CAAuB,MAAvB,CAAb;AAEA,IAAA,IAAI,CAAC,GAAL,GAAW,YAAX;AACA,IAAA,IAAI,CAAC,YAAL,CAAkB,aAAlB,EAAiC,WAAjC;AACA,IAAA,IAAI,CAAC,MAAL,GAAc,OAAd;AACA,IAAA,IAAI,CAAC,IAAL,GAAY,yBAAuB,KAAvB,GAA4B,cAAxC;AAEA,IAAA,QAAQ,CAAC,IAAT,CAAc,WAAd,CAA0B,IAA1B;AAEA,IAAA,gBAAgB,CAAC,SAAD,EAAY,UAAA,KAAA,EAAK;AAC7B,UAAI,KAAK,CAAC,MAAN,KAAiB,MAAjB,IAA2B,KAAK,CAAC,IAAN,CAAW,IAAX,KAAoB,WAAnD,EAAgE;AAC5D,QAAA,IAAI,CAAC,IAAL,GAAY,yBAAuB,KAAK,CAAC,IAAN,CAAW,KAAlC,GAAuC,cAAnD;AACH;AACJ,KAJe,CAAhB;AAKH,GAfM,CAAP;AAgBH;;;;;;;;;ACjBD;;AACA;;AAYA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,4BAAe,8BAAf;;AAEA,SAAS,SAAT,GAAkB;AACd,MAAI,+BAAK,WAAL,KAAqB,IAAzB,EAA+B;AAC3B,WAAO,+BAAkB,+BAAK,WAAvB,CAAP;AACH;;AAED,SAAO,6BAAgB,+BAAK,SAArB,CAAP;AACH;;AAED,SAAe,SAAf,GAAwB;;;;;;;;;AACpB,iBAAA,CAAA,CAAA,EAAM,uBAAN,CAAA;;;AAAA,UAAA,EAAA,CAAA,IAAA;;AAGoB,iBAAA,CAAA,CAAA,EAAM,OAAO,CAAC,GAAR,CAAY,CAClC,SAAS,EADyB,EAElC,uBAFkC,EAGlC,sBAAU,+BAAK,KAAf,EAAsB,+BAAK,MAA3B,CAHkC,CAAZ,CAAN,CAAA;;;AAAhB,UAAA,EAAA,GAAgB,EAAA,CAAA,IAAA,EAAhB,EAAC,KAAK,GAAA,EAAA,CAAA,CAAA,CAAN,EAAQ,IAAI,GAAA,EAAA,CAAA,CAAA,CAAZ;AAMJ,uCAAe,+BAAK,MAApB;AAEM,UAAA,QAAQ,GAAG,IAAI,oCAAJ,CAAsB,IAAtB,EAA4B,KAA5B,CAAX;AAEN,UAAA,QAAQ,CAAC,IAAT,CAAc,WAAd,CAA0B,QAAQ,CAAC,OAAnC;;AAEA,cAAI,KAAK,IAAI,KAAK,CAAC,QAAN,GAAiB,CAA9B,EAAiC;AAC7B,YAAA,cAAc,CAAC,KAAD,EAAQ,QAAR,CAAd;AACH;;AAED;;AAEA,cAAI,KAAK,IAAI,KAAK,CAAC,MAAnB,EAA2B;AACvB,mBAAA,CAAA,CAAA,CAAA;AACH;;AAED,0CAAgB,CAAC,CAAC,IAAlB;;AAEM,UAAA,MAAM,GAAG,gBAAO,QAAP,EAAuB;AAAA,mBAAA,SAAA,CAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;;;;;AAClC,2BAAA,CAAA,CAAA,EAAM,YAAY,EAAlB,CAAA;;;AAAA,oBAAA,EAAA,CAAA,IAAA;;yBAEI,CAAC,OAAD,OAAA,CAAA,CAAA,EAAA,CAAA,CAAA;AACQ,2BAAA,CAAA,CAAA,EAAM,yBACV,+BAAK,SADK,EAEV,+BAAK,GAFK,EAGV,+BAAK,KAHK,EAIV,+BAAK,WAAL,IAAoB,EAJV,EAKV,+BAAK,KALK,CAAN,CAAA;;;AAAR,oBAAA,KAAK,GAAG,EAAA,CAAA,IAAA,EAAR;AAOA,oBAAA,QAAQ,CAAC,QAAT,CAAkB,KAAlB;;;;AAGY,2BAAA,CAAA,CAAA,EAAM,yBAAY,KAAK,CAAC,MAAlB,EAA0B,QAA1B,CAAN,CAAA;;;AAAV,oBAAA,OAAO,GAAG,EAAA,CAAA,IAAA,EAAV;AAEN,oBAAA,QAAQ,CAAC,aAAT,CAAuB,OAAvB,EAAgC,IAAhC;AACA,oBAAA,mBAAmB,CAAC,KAApB;;;;aAjBkC,CAAA;AAkBrC,WAlBK;;AAoBA,UAAA,mBAAmB,GAAG,IAAI,wCAAJ,CAAwB,IAAxB,EAA8B,MAA9B,CAAtB;AAEN,UAAA,QAAQ,CAAC,OAAT,CAAiB,WAAjB,CAA6B,mBAAmB,CAAC,OAAjD;;;;;AACH;;AAED,SAAS;AAET,gBAAgB,CAAC,eAAD,EAAkB,SAAS,kBAAT,GAA2B;AACzD,EAAA,mBAAmB,CAAC,eAAD,EAAkB,kBAAlB,CAAnB;AACA,EAAA,QAAQ,CAAC,aAAT,CAAuB,WAAvB,EAAqC,kBAArC,CAAwD,YAAxD,EAAsE,uGAEnB,+BAAK,KAFc,GAET,GAFS,GAEL,+BAAK,IAFA,GAEI,mUAF1E;AASA;AACH,CAZe,CAAhB;;AAcA,SAAe,cAAf,CAA8B,KAA9B,EAA4C,QAA5C,EAAuE;;;;;;;;;AAC7D,UAAA,UAAU,GAAG,oBAAC,IAAD,EAAqB;AACpC,iBAAsB,IAAA,EAAA,GAAA,CAAA,EAAA,MAAA,GAAA,IAAtB,EAAsB,EAAA,GAAA,MAAA,CAAA,MAAtB,EAAsB,EAAA,EAAtB,EAA4B;AAAvB,kBAAM,OAAO,GAAA,MAAA,CAAA,EAAA,CAAb;AACD,cAAA,QAAQ,CAAC,aAAT,CAAuB,OAAvB,EAAgC,KAAhC;AACH;AACJ,WAJK;;AAMA,UAAA,SAAS,GAAG,IAAI,CAAC,IAAL,CAAU,KAAK,CAAC,QAAN,GAAiB,iBAA3B,CAAZ;AAEA,UAAA,SAAS,GAAG,CAAC,8BAAiB,KAAK,CAAC,MAAvB,EAA+B,CAA/B,CAAD,CAAZ;;AAGN,cAAI,SAAS,GAAG,CAAhB,EAAmB;AACf,YAAA,SAAS,CAAC,IAAV,CAAe,8BAAiB,KAAK,CAAC,MAAvB,EAA+B,SAA/B,CAAf;AACH;;AAGD,cAAI,SAAS,GAAG,CAAZ,IAAiB,KAAK,CAAC,QAAN,GAAiB,iBAAjB,GAA6B,CAAlD,EAAqD;AACjD,YAAA,SAAS,CAAC,IAAV,CAAe,8BAAiB,KAAK,CAAC,MAAvB,EAA+B,SAAS,GAAG,CAA3C,CAAf;AACH;;AAGa,iBAAA,CAAA,CAAA,EAAM,OAAO,CAAC,GAAR,CAAY,SAAZ,CAAN,CAAA;;;AAAR,UAAA,KAAK,GAAG,EAAA,CAAA,IAAA,EAAR;;AAEN,eAAA,EAAA,GAAA,CAAA,EAAmB,OAAA,GAAA,KAAnB,EAAmB,EAAA,GAAA,OAAA,CAAA,MAAnB,EAAmB,EAAA,EAAnB,EAA0B;AAArB,YAAA,MAAA,GAAA,OAAA,CAAA,EAAA,CAAA;AACD,YAAA,UAAU,CAAC,MAAD,CAAV;AACH;;AAGG,UAAA,eAAe,GAAG,SAAS,GAAG,SAAS,CAAC,MAAxC;AACA,UAAA,cAAc,GAAG,CAAjB;;AACE,UAAA,aAAY,GAAG,sBAAC,SAAD,EAA0B;AAC3C,gBAAI,eAAe,KAAK,CAAxB,EAA2B;AACvB;AACH;;AAED,gBAAM,IAAI,GAAG,SAAP,IAAO,GAAA;AAAA,qBAAA,SAAA,CAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;;;;;AACT,sBAAA,MAAM,CAAC,OAAP;AAEa,6BAAA,CAAA,CAAA,EAAM,8BAAiB,KAAK,CAAC,MAAvB,EAA+B,cAA/B,CAAN,CAAA;;;AAAP,sBAAA,IAAI,GAAG,EAAA,CAAA,IAAA,EAAP;AAEN,sBAAA,MAAM,CAAC,MAAP;AACA,sBAAA,UAAU,CAAC,IAAD,CAAV;AACA,sBAAA,eAAe;AACf,sBAAA,cAAc;;AACd,sBAAA,aAAY,CAAC,IAAD,CAAZ;;;;;eATS,CAAA;AAUZ,aAVD;;AAYA,gBAAM,YAAY,GAAG,SAAS,CAAC,GAAV,EAArB;AACA,gBAAM,MAAM,GAAG,QAAQ,CAAC,gBAAT,CAA0B,YAA1B,EAAwC,eAAe,GAAG,iBAA1D,EAAqE,IAArE,CAAf;AACH,WAnBK;;AAqBN,UAAA,aAAY,CAAC,KAAK,CAAC,CAAD,CAAN,CAAZ;;;;;;AACH;;AAEK,SAAgB,YAAhB,GAA4B;;;;;;AACV,iBAAA,CAAA,CAAA,EAAM,gCAAN,CAAA;;;AAAZ,UAAA,OAAO,GAAK,EAAA,CAAA,IAAA,EAAA,CAAqB,OAAjC;AACA,UAAA,MAAM,GAAkB,+BAAI,MAA5B,EAAQ,KAAK,GAAW,+BAAI,KAA5B,EAAe,IAAI,GAAK,+BAAI,IAA5B;;AAER,cAAI,OAAO,CAAC,OAAR,CAAgB,MAAhB,MAA4B,CAAC,CAAjC,EAAoC;AAChC,mBAAA,CAAA,CAAA,CAAA;AACH;;AAED,UAAA,QAAQ,CAAC,aAAT,CAAuB,WAAvB,EAAqC,gBAArC,CAAuD,kBAAvD,CAA0E,aAA1E,EAAyF,+FAElE,MAFkE,GAE5D,4CAF4D,GAEf,KAFe,GAEV,GAFU,GAEN,IAFM,GAEF,mJAFE,GAInD,KAJmD,GAI9C,GAJ8C,GAI1C,IAJ0C,GAItC,yJAJsC,GAO9D,MAP8D,GAOxD,+GAPwD,GASpE,IAAI,CAAC,SAAL,CAAe;AAAE,YAAA,OAAO,EAAE,CAAC,MAAD;AAAX,WAAf,EAAsC,IAAtC,EAA4C,CAA5C,CAToE,GAStB,qCATnE;AAaA;AAEA,gBAAM,IAAI,KAAJ,CAAU,uBAAV,CAAN;;;;AACH","file":"vartalk.58eb2af4.js","sourceRoot":"../src","sourcesContent":["export function deparam(query: string): Record<string, string> {\n    let match: RegExpExecArray | null;\n    const plus = /\\+/g;\n    const search = /([^&=]+)=?([^&]*)/g;\n    const decode = (s: string) => decodeURIComponent(s.replace(plus, ' '));\n    const params: Record<string, string> = {};\n\n    // tslint:disable-next-line:no-conditional-assignment\n    while (match = search.exec(query)) {\n        params[decode(match[1])] = decode(match[2]);\n    }\n\n    return params;\n}\n\nexport function param(obj: Record<string, string>) {\n    const parts = [];\n\n    for (const name in obj) {\n        if (obj.hasOwnProperty(name) && obj[name]) {\n            parts.push(`${encodeURIComponent(name)}=${encodeURIComponent(obj[name])}`);\n        }\n    }\n\n    return parts.join('&');\n}\n","export default /^([\\w-_]+)\\/([\\w-_.]+)$/i;\n","// export const UTTERANCES_API = 'http://localhost:5000';\nexport const UTTERANCES_API = 'https://api.vartalk.cn';\n","import { UTTERANCES_API } from './vartalk-api';\nimport { param } from './deparam';\n\nexport const token = { value: null as null | string };\n\n// tslint:disable-next-line:variable-name\nexport function getLoginUrl(redirect_uri: string) {\n    return `${UTTERANCES_API}/authorize?${param({ redirect_uri })}`;\n}\n\nexport async function loadToken(): Promise<string | null> {\n    if (token.value) {\n        return token.value;\n    }\n\n    const url = `${UTTERANCES_API}/token`;\n    const response = await fetch(url, {\n        method: 'POST',\n        mode: 'cors',\n        credentials: 'include',\n    });\n\n    if (response.ok) {\n        const t = await response.json();\n\n        token.value = t;\n\n        return t;\n    }\n\n    return null;\n}\n","import { deparam } from './deparam';\nimport repoRegex from './repo-regex';\nimport { token } from './oauth';\n\nfunction readPageAttributes() {\n    const params = deparam(location.search.substr(1));\n\n    let issueTerm: string | null = null;\n    let issueNumber: number | null = null;\n\n    if ('issue-term' in params) {\n        issueTerm = params['issue-term'];\n\n        if (issueTerm !== undefined) {\n            if (issueTerm === '') {\n                throw new Error('When issue-term is specified, it cannot be blank.');\n            }\n\n            if (['title', 'url', 'pathname', 'og:title'].indexOf(issueTerm) !== -1) {\n                if (!params[issueTerm]) {\n                    throw new Error(`Unable to find \"${issueTerm}\" metadata.`);\n                }\n\n                issueTerm = params[issueTerm];\n            }\n        }\n    } else if ('issue-number' in params) {\n        issueNumber = +params['issue-number'];\n\n        if (issueNumber.toString(10) !== params['issue-number']) {\n            throw new Error(`issue-number is invalid. \"${params['issue-number']}`);\n        }\n    } else {\n        throw new Error('\"issue-term\" or \"issue-number\" must be specified.');\n    }\n\n    if (!('repo' in params)) {\n        throw new Error('\"repo\" is required.');\n    }\n\n    if (!('origin' in params)) {\n        throw new Error('\"origin\" is required.');\n    }\n\n    const matches = repoRegex.exec(params.repo);\n\n    if (matches === null) {\n        throw new Error(`Invalid repo: \"${params.repo}\"`);\n    }\n\n    if (params.token) {\n        token.value = params.token;\n    }\n\n    return {\n        owner: matches[1],\n        repo: matches[2],\n        issueTerm,\n        issueNumber,\n        origin: params.origin,\n        url: params.url,\n        title: params.title,\n        description: params.description,\n        label: params.label,\n        theme: params.theme || 'github-light'\n    };\n}\n\nexport const pageAttributes = readPageAttributes();\n","declare function escape(str: string): string;\n\nexport function decodeBase64UTF8(encoded: string) {\n    encoded = encoded.replace(/\\s/g, '');\n\n    return decodeURIComponent(escape(atob(encoded)));\n}\n","import { token } from './oauth';\nimport { decodeBase64UTF8 } from './encoding';\nimport { UTTERANCES_API } from './vartalk-api';\n\nconst GITHUB_API = 'https://api.github.com/';\nconst GITHUB_ENCODING__HTML_JSON = 'application/vnd.github.VERSION.html+json';\nconst GITHUB_ENCODING__HTML = 'application/vnd.github.VERSION.html';\nconst GITHUB_ENCODING__REACTIONS_PREVIEW = 'application/vnd.github.squirrel-girl-preview';\n\nexport const PAGE_SIZE = 25;\n\nexport type ReactionID = '+1' | '-1' | 'laugh' | 'hooray' | 'confused' | 'heart' | 'rocket' | 'eyes';\n\nexport const reactionTypes: ReactionID[] = ['+1', '-1', 'laugh', 'hooray', 'confused', 'heart', 'rocket', 'eyes'];\n\nlet owner: string;\nlet repo: string;\nconst branch = 'master';\n\nexport function setRepoContext(context: { owner: string; repo: string; }) {\n    owner = context.owner;\n    repo = context.repo;\n}\n\nfunction githubRequest(relativeUrl: string, init?: RequestInit) {\n    init = init || {};\n    init.mode = 'cors';\n    init.cache = 'no-cache'; // force conditional request\n\n    const request = new Request(GITHUB_API + relativeUrl, init);\n\n    request.headers.set('Accept', GITHUB_ENCODING__REACTIONS_PREVIEW);\n\n    if (!/^search\\//.test(relativeUrl) && token.value !== null) {\n        request.headers.set('Authorization', `token ${token.value}`);\n    }\n\n    return request;\n}\n\nconst rateLimit = {\n    standard: {\n        limit: Number.MAX_VALUE,\n        remaining: Number.MAX_VALUE,\n        reset: 0\n    },\n    search: {\n        limit: Number.MAX_VALUE,\n        remaining: Number.MAX_VALUE,\n        reset: 0\n    }\n};\n\nfunction processRateLimit(response: Response) {\n    const limit = response.headers.get('X-RateLimit-Limit')!;\n    const remaining = response.headers.get('X-RateLimit-Remaining')!;\n    const reset = response.headers.get('X-RateLimit-Reset')!;\n\n    const isSearch = /\\/search\\//.test(response.url);\n    const rate = isSearch ? rateLimit.search : rateLimit.standard;\n\n    rate.limit = +limit;\n    rate.remaining = +remaining;\n    rate.reset = +reset;\n\n    if (response.status === 403 && rate.remaining === 0) {\n        const resetDate = new Date(0);\n\n        resetDate.setUTCSeconds(rate.reset);\n\n        const mins = Math.round((resetDate.getTime() - new Date().getTime()) / 1000 / 60);\n        const apiType = isSearch ? 'search API' : 'non-search APIs';\n\n        // tslint:disable-next-line:no-console\n        console.warn(`Rate limit exceeded for ${apiType}. Resets in ${mins} minute${mins === 1 ? '' : 's'}.`);\n    }\n}\n\nexport function readRelNext(response: Response) {\n    const link = response.headers.get('link');\n\n    if (link === null) {\n        return 0;\n    }\n\n    const match = /\\?page=([2-9][0-9]*)>; rel=\"next\"/.exec(link);\n\n    if (match === null) {\n        return 0;\n    }\n\n    return +match[1];\n}\n\nfunction githubFetch(request: Request): Promise<Response> {\n    return fetch(request).then(response => {\n        if (response.status === 401) {\n            token.value = null;\n        }\n\n        if (response.status === 403) {\n            response.json().then(data => {\n                if (data.message === 'Resource not accessible by integration') {\n                    window.dispatchEvent(new CustomEvent('not-installed'));\n                }\n            });\n        }\n\n        processRateLimit(response);\n\n        if (request.method === 'GET' && [401, 403].indexOf(response.status) !== -1 && request.headers.has('Authorization')) {\n            request.headers.delete('Authorization');\n\n            return githubFetch(request);\n        }\n\n        return response;\n    });\n}\n\nexport function loadJsonFile<T>(path: string, html = false) {\n    const request = githubRequest(`repos/${owner}/${repo}/contents/${path}?ref=${branch}`);\n\n    if (html) {\n        request.headers.set('accept', GITHUB_ENCODING__HTML);\n    }\n\n    return githubFetch(request).then<FileContentsResponse | string>(response => {\n        if (response.status === 404) {\n            throw new Error(`Repo \"${owner}/${repo}\" does not have a file named \"${path}\" in the \"${branch}\" branch.`);\n        }\n\n        if (!response.ok) {\n            throw new Error(`Error fetching ${path}.`);\n        }\n\n        return html ? response.text() : response.json();\n    }).then<T>(file => {\n        if (html) {\n            return file;\n        }\n\n        const { content } = file as FileContentsResponse;\n        const decoded = decodeBase64UTF8(content);\n\n        return JSON.parse(decoded);\n    });\n}\n\nexport function loadIssueByTerm(term: string) {\n    const q = `\"${term}\" type:issue in:title repo:${owner}/${repo}`;\n    const request = githubRequest(`search/issues?q=${encodeURIComponent(q)}&sort=created&order=asc`);\n\n    return githubFetch(request).then<IssueSearchResponse>(response => {\n        if (!response.ok) {\n            throw new Error('Error fetching issue via search.');\n        }\n\n        return response.json();\n    }).then(results => {\n        if (results.total_count === 0) {\n            return null;\n        }\n\n        if (results.total_count > 1) {\n            // tslint:disable-next-line:no-console\n            console.warn(`Multiple issues match \"${q}\".`);\n        }\n\n        term = term.toLowerCase();\n\n        for (const result of results.items) {\n            if (result.title.toLowerCase().indexOf(term) !== -1) {\n                return result;\n            }\n        }\n\n        // tslint:disable-next-line:no-console\n        console.warn(`Issue search results do not contain an issue with title matching \"${term}\". Using first result.`);\n\n        return results.items[0];\n    });\n}\n\nexport function loadIssueByNumber(issueNumber: number) {\n    const request = githubRequest(`repos/${owner}/${repo}/issues/${issueNumber}`);\n\n    return githubFetch(request).then<Issue>(response => {\n        if (!response.ok) {\n            throw new Error('Error fetching issue via issue number.');\n        }\n\n        return response.json();\n    });\n}\n\nfunction commentsRequest(issueNumber: number, page: number) {\n    const url = `repos/${owner}/${repo}/issues/${issueNumber}/comments?page=${page}&per_page=${PAGE_SIZE}`;\n    const request = githubRequest(url);\n    const accept = `${GITHUB_ENCODING__HTML_JSON},${GITHUB_ENCODING__REACTIONS_PREVIEW}`;\n\n    request.headers.set('Accept', accept);\n\n    return request;\n}\n\nexport function loadCommentsPage(issueNumber: number, page: number): Promise<IssueComment[]> {\n    const request = commentsRequest(issueNumber, page);\n\n    return githubFetch(request).then(response => {\n        if (!response.ok) {\n            throw new Error('Error fetching comments.');\n        }\n\n        return response.json();\n    });\n}\n\nexport function loadUser(): Promise<User | null> {\n    if (token.value === null) {\n        return Promise.resolve(null);\n    }\n\n    return githubFetch(githubRequest('user')).then(response => {\n        if (response.ok) {\n            return response.json();\n        }\n\n        return null;\n    });\n}\n\nexport function createIssue(issueTerm: string, documentUrl: string, title: string, description: string, label: string) {\n    const url = `${UTTERANCES_API}/repos/${owner}/${repo}/issues${label ? `?label=${encodeURIComponent(label)}` : ''}`;\n    const request = new Request(url, {\n        method: 'POST',\n        body: JSON.stringify({\n            title: issueTerm,\n            body: `# ${title}\\n\\n${description}\\n\\n[${documentUrl}](${documentUrl})`\n        }),\n    });\n\n    request.headers.set('Accept', GITHUB_ENCODING__REACTIONS_PREVIEW);\n    request.headers.set('Authorization', `token ${token.value}`);\n\n    return fetch(request).then<Issue>(response => {\n        if (!response.ok) {\n            throw new Error('Error creating comments container issue');\n        }\n\n        return response.json();\n    });\n}\n\nexport function postComment(issueNumber: number, markdown: string) {\n    const url = `repos/${owner}/${repo}/issues/${issueNumber}/comments`;\n    const body = JSON.stringify({ body: markdown });\n    const request = githubRequest(url, { method: 'POST', body });\n    const accept = `${GITHUB_ENCODING__HTML_JSON},${GITHUB_ENCODING__REACTIONS_PREVIEW}`;\n\n    request.headers.set('Accept', accept);\n\n    return githubFetch(request).then<IssueComment>(response => {\n        if (!response.ok) {\n            throw new Error('Error posting comment.');\n        }\n\n        return response.json();\n    });\n}\n\nexport async function toggleReaction(url: string, content: ReactionID) {\n    url = url.replace(GITHUB_API, '');\n\n    // We don't know if the reaction exists or not. Attempt to create it. If the GitHub\n    // API responds that the reaction already exists, delete it.\n    const body = JSON.stringify({ content });\n    const postRequest = githubRequest(url, { method: 'POST', body });\n\n    postRequest.headers.set('Accept', GITHUB_ENCODING__REACTIONS_PREVIEW);\n\n    const response = await githubFetch(postRequest);\n    const reaction: Reaction = response.ok ? await response.json() : null;\n\n    if (response.status === 201) { // reaction created.\n        return { reaction, deleted: false };\n    }\n\n    if (response.status !== 200) {\n        throw new Error('expected \"201 reaction created\" or \"200 reaction already exists\"');\n    }\n\n    // reaction already exists... delete.\n    const deleteRequest = githubRequest(`reactions/${reaction.id}`, { method: 'DELETE' });\n\n    deleteRequest.headers.set('Accept', GITHUB_ENCODING__REACTIONS_PREVIEW);\n\n    await githubFetch(deleteRequest);\n\n    return { reaction, deleted: true };\n}\n\nexport function renderMarkdown(text: string) {\n    const body = JSON.stringify({ text, mode: 'gfm', context: `${owner}/${repo}` });\n\n    return githubFetch(githubRequest('markdown', { method: 'POST', body })).then(response => response.text());\n}\n\ninterface IssueSearchResponse {\n    total_count: number;\n    incomplete_results: boolean;\n    items: Issue[];\n}\n\nexport interface User {\n    login: string;\n    id: number;\n    avatar_url: string;\n    gravatar_id: string;\n    url: string;\n    html_url: string;\n    followers_url: string;\n    following_url: string;\n    gists_url: string;\n    starred_url: string;\n    subscriptions_url: string;\n    organizations_url: string;\n    repos_url: string;\n    events_url: string;\n    received_events_url: string;\n    type: string;\n}\n\nexport type CommentAuthorAssociation =\n    'COLLABORATOR'\n    | 'CONTRIBUTOR'\n    | 'FIRST_TIMER'\n    | 'FIRST_TIME_CONTRIBUTOR'\n    | 'MEMBER'\n    | 'NONE'\n    | 'OWNER';\n\nexport interface Reactions {\n    url: string;\n    total_count: number;\n    '+1': number;\n    '-1': number;\n    laugh: number;\n    hooray: number;\n    confused: number;\n    heart: number;\n    rocket: number;\n    eyes: number;\n}\n\nexport interface Reaction {\n    id: number;\n    user: User;\n    content: ReactionID;\n    created_at: string;\n}\n\nexport interface Issue {\n    url: string;\n    repository_url: string;\n    labels_url: string;\n    comments_url: string;\n    events_url: string;\n    html_url: string;\n    id: number;\n    number: number;\n    title: string;\n    user: User;\n    locked: boolean;\n    labels: {\n        url: string;\n        name: string;\n        color: string;\n    }[];\n    state: string;\n    assignee: null; // todo,\n    milestone: null; // todo,\n    comments: number;\n    created_at: string;\n    updated_at: string;\n    closed_at: null; // todo,\n    pull_request: {\n        html_url: null; // todo,\n        diff_url: null; // todo,\n        patch_url: null; // todo\n    };\n    body: string;\n    score: number;\n    reactions: Reactions;\n    author_association: CommentAuthorAssociation;\n}\n\ninterface FileContentsResponse {\n    type: string;\n    encoding: string;\n    size: number;\n    name: string;\n    path: string;\n    content: string;\n    sha: string;\n    url: string;\n    git_url: string;\n    html_url: string;\n    download_url: string;\n}\n\nexport interface IssueComment {\n    id: number;\n    url: string;\n    html_url: string;\n    body_html: string;\n    user: User;\n    created_at: string;\n    updated_at: string;\n    author_association: CommentAuthorAssociation;\n    reactions: Reactions;\n}\n\n/*\nquery IssueComments($owner: String!, $repo: String!, $issueQuery: String!) {\n    search(query: $issueQuery, type: ISSUE, first: 1) {\n        issueCount\n        edges {\n            node {\n                ... on Issue {\n                    id\n                    title,\n                    comments(first: 100) {\n                        totalCount\n                        edges {\n                            node {\n                                id,\n                                createdAt,\n                                bodyHTML,\n                                author {\n                                    avatarUrl,\n                                    login\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    rateLimit {\n        cost\n        limit\n        remaining\n        resetAt\n    }\n\n    repository(owner: $owner, name: $repo) {\n        object(expression: \"master:vartalk.json\") {\n            ... on Blob {\n                text\n            }\n        }\n    }\n}\n\n{\n    \"issueQuery\": \"user:varxzy repo:vartalk-demo debug\",\n    \"owner\": \"varxzy\",\n    \"repo\": \"vartalk-demo\"\n}\n*/\n","// todo: take a dependency on some relative time library.\n\nconst thresholds = [\n    1000, 'second',\n    1000 * 60, 'minute',\n    1000 * 60 * 60, 'hour',\n    1000 * 60 * 60 * 24, 'day',\n    1000 * 60 * 60 * 24 * 7, 'week',\n    1000 * 60 * 60 * 24 * 27, 'month'\n];\n\nconst formatOptions: Intl.DateTimeFormatOptions = { month: 'short', day: 'numeric', year: 'numeric' };\n\nexport function timeAgo(current: number, value: Date) {\n    const elapsed = current - value.getTime();\n\n    if (elapsed < 5000) {\n        return 'just now';\n    }\n\n    let i = 0;\n\n    while (i + 2 < thresholds.length && elapsed * 1.1 > thresholds[i + 2]) {\n        i += 2;\n    }\n\n    const divisor = thresholds[i] as number;\n    const text = thresholds[i + 1] as string;\n    const units = Math.round(elapsed / divisor);\n\n    if (units > 3 && i === thresholds.length - 2) {\n        return `on ${value.toLocaleDateString(undefined, formatOptions)}`;\n    }\n\n    return units === 1 ? `${text === 'hour' ? 'an' : 'a'} ${text} ago` : `${units} ${text}s ago`;\n}\n","export interface ResizeMessage {\n    type: 'resize';\n    height: number;\n}\n\nlet hostOrigin: string;\n\nexport function startMeasuring(origin: string) {\n    hostOrigin = origin;\n    addEventListener('resize', scheduleMeasure);\n    addEventListener('load', scheduleMeasure);\n}\n\nlet lastHeight = -1;\n\nfunction measure() {\n    const height = document.body.scrollHeight;\n\n    if (height === lastHeight) {\n        return;\n    }\n\n    lastHeight = height;\n\n    const message: ResizeMessage = { type: 'resize', height };\n\n    parent.postMessage(message, hostOrigin);\n}\n\nlet lastMeasure = 0;\n\nexport function scheduleMeasure() {\n    const now = Date.now();\n\n    if (now - lastMeasure > 50) {\n        lastMeasure = now;\n        setTimeout(measure, 50);\n    }\n}\n","import { toggleReaction, ReactionID, reactionTypes } from './github';\nimport { getLoginUrl } from './oauth';\nimport { pageAttributes } from './page-attributes';\nimport { scheduleMeasure } from './measure';\n\nexport const reactionNames: Record<ReactionID, string> = {\n    '+1': 'Thumbs Up',\n    '-1': 'Thumbs Down',\n    'laugh': 'Laugh',\n    'hooray': 'Hooray',\n    'confused': 'Confused',\n    'heart': 'Heart',\n    'rocket': 'Rocket',\n    'eyes': 'Eyes'\n};\n\nexport const reactionEmoji: Record<ReactionID, string> = {\n    '+1': '',\n    '-1': '',\n    'laugh': '',\n    'hooray': '',\n    'confused': '',\n    'heart': '',\n    'rocket': '',\n    'eyes': ''\n};\n\nexport function getReactionHtml(url: string, reaction: ReactionID, disabled: boolean, count: number) {\n    return `\n        <button\n            reaction\n            type=\"submit\"\n            action=\"javascript:\"\n            formaction=\"${url}\"\n            class=\"btn BtnGroup-item btn-outline reaction-button\"\n            value=\"${reaction}\"\n            aria-label=\"Toggle ${reactionNames[reaction]} reaction\"\n            reaction-count=\"${count}\"\n            ${disabled ? 'disabled' : ''}\n        >${reactionEmoji[reaction]}</button>\n    `;\n}\n\nexport function enableReactions(authenticated: boolean) {\n    const submitReaction = async (event: Event) => {\n        const button = event.target instanceof HTMLElement && event.target.closest('button');\n\n        if (!button) {\n            return;\n        }\n\n        if (!button.hasAttribute('reaction')) {\n            return;\n        }\n\n        event.preventDefault();\n\n        if (!authenticated) {\n            return;\n        }\n\n        button.disabled = true;\n\n        const parentMenu = button.closest('details');\n\n        if (parentMenu) {\n            parentMenu.open = false;\n        }\n\n        const url = button.formAction;\n        const id = button.value as ReactionID;\n        const { deleted } = await toggleReaction(url, id);\n        const selector = `button[reaction][formaction=\"${url}\"][value=\"${id}\"],[reaction-count][reaction-url=\"${url}\"]`;\n        const elements = Array.from(document.querySelectorAll(selector));\n        const delta = deleted ? -1 : 1;\n\n        for (const element of elements) {\n            element.setAttribute('reaction-count', (parseInt(element.getAttribute('reaction-count')!, 10) + delta).toString());\n        }\n\n        button.disabled = false;\n        scheduleMeasure();\n    };\n    addEventListener('click', submitReaction, true);\n}\n\nexport function getReactionsMenuHtml(url: string, align: 'center' | 'right') {\n    const position = align === 'center' ? 'left: 50%;transform: translateX(-50%)' : 'right:6px';\n    const alignmentClass = align === 'center' ? '' : 'Popover-message--top-right';\n    const getButtonAndSpan = (id: ReactionID) => getReactionHtml(url, id, false, 0) + `<span class=\"reaction-name\" aria-hidden=\"true\">${reactionNames[id]}</span>`;\n\n    return `\n        <details class=\"details-overlay details-popover reactions-popover\">\n            <summary ${align === 'center' ? 'tabindex=\"-1\"' : ''}>${addReactionSvgs}</summary>\n            <div class=\"Popover\" style=\"${position}\">\n                <form class=\"Popover-message ${alignmentClass} box-shadow-large\" action=\"javascript:\">\n                    <span class=\"reaction-name\">Pick your reaction</span>\n                    <div class=\"BtnGroup\">\n                        ${reactionTypes.slice(0, 4).map(getButtonAndSpan).join('')}\n                    </div>\n                    <div class=\"BtnGroup\">\n                        ${reactionTypes.slice(4).map(getButtonAndSpan).join('')}\n                    </div>\n                </form>\n            </div>\n        </details>\n    `;\n}\n\nexport function getSignInToReactMenuHtml(align: 'center' | 'right') {\n    const position = align === 'center' ? 'left: 50%;transform: translateX(-50%)' : 'right:6px';\n    const alignmentClass = align === 'center' ? '' : 'Popover-message--top-right';\n\n    return `\n        <details class=\"details-overlay details-popover reactions-popover\">\n            <summary aria-label=\"Reactions Menu\">${addReactionSvgs}</summary>\n            <div class=\"Popover\" style=\"${position}\">\n                <div class=\"Popover-message ${alignmentClass} box-shadow-large\" style=\"padding: 16px\">\n                    <span><a href=\"${getLoginUrl(pageAttributes.url)}\" target=\"_top\">Sign in</a> to add your reaction.</span>\n                </div>\n            </div>\n        </details>\n    `;\n}\n\n// tslint:disable-next-line:max-line-length\nconst addReactionSvgs = `<svg class=\"octicon\" style=\"margin-right:3px\" viewBox=\"0 0 7 16\" version=\"1.1\" width=\"7\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M4 4H3v3H0v1h3v3h1V8h3V7H4V4z\"></path></svg><svg class=\"octicon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M8 0C3.58 0 0 3.58 0 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm4.81 12.81a6.72 6.72 0 0 1-2.17 1.45c-.83.36-1.72.53-2.64.53-.92 0-1.81-.17-2.64-.53-.81-.34-1.55-.83-2.17-1.45a6.773 6.773 0 0 1-1.45-2.17A6.59 6.59 0 0 1 1.21 8c0-.92.17-1.81.53-2.64.34-.81.83-1.55 1.45-2.17.62-.62 1.36-1.11 2.17-1.45A6.59 6.59 0 0 1 8 1.21c.92 0 1.81.17 2.64.53.81.34 1.55.83 2.17 1.45.62.62 1.11 1.36 1.45 2.17.36.83.53 1.72.53 2.64 0 .92-.17 1.81-.53 2.64-.34.81-.83 1.55-1.45 2.17zM4 6.8v-.59c0-.66.53-1.19 1.2-1.19h.59c.66 0 1.19.53 1.19 1.19v.59c0 .67-.53 1.2-1.19 1.2H5.2C4.53 8 4 7.47 4 6.8zm5 0v-.59c0-.66.53-1.19 1.2-1.19h.59c.66 0 1.19.53 1.19 1.19v.59c0 .67-.53 1.2-1.19 1.2h-.59C9.53 8 9 7.47 9 6.8zm4 3.2c-.72 1.88-2.91 3-5 3s-4.28-1.13-5-3c-.14-.39.23-1 .66-1h8.59c.41 0 .89.61.75 1z\"></path></svg>`;\n","import { CommentAuthorAssociation, IssueComment, reactionTypes } from './github';\nimport { timeAgo } from './time-ago';\nimport { scheduleMeasure } from './measure';\nimport { getReactionsMenuHtml, getReactionHtml, getSignInToReactMenuHtml } from './reactions';\n\nconst avatarArgs = '?v=3&s=88';\nconst displayAssociations: Record<CommentAuthorAssociation, string> = {\n    COLLABORATOR: 'Collaborator',\n    CONTRIBUTOR: 'Contributor',\n    MEMBER: 'Member',\n    OWNER: 'Owner',\n    FIRST_TIME_CONTRIBUTOR: 'First time contributor',\n    FIRST_TIMER: 'First timer',\n    NONE: ''\n};\n\nexport class CommentComponent {\n    public readonly element: HTMLElement;\n\n    constructor(\n        public comment: IssueComment,\n        private currentUser: string | null,\n        locked: boolean\n    ) {\n        const { user, html_url, created_at, body_html, author_association, reactions } = comment;\n\n        this.element = document.createElement('article');\n        this.element.classList.add('timeline-comment');\n\n        if (user.login === currentUser) {\n            this.element.classList.add('current-user');\n        }\n\n        const association = displayAssociations[author_association];\n        const reactionCount = reactionTypes.reduce((sum, id) => sum + reactions[id], 0);\n        let headerReactionsMenu = '';\n        let footerReactionsMenu = '';\n\n        if (!locked) {\n            if (currentUser) {\n                headerReactionsMenu = getReactionsMenuHtml(comment.reactions.url, 'right');\n                footerReactionsMenu = getReactionsMenuHtml(comment.reactions.url, 'center');\n            } else {\n                headerReactionsMenu = getSignInToReactMenuHtml('right');\n                footerReactionsMenu = getSignInToReactMenuHtml('center');\n            }\n        }\n\n        this.element.innerHTML = `\n            <a class=\"avatar\" href=\"${user.html_url}\" target=\"_blank\" tabindex=\"-1\"><img src=\"${user.avatar_url}${avatarArgs}\" width=\"44\" height=\"44\" alt=\"@${user.login}\"></a>\n            <div class=\"comment\">\n                <header class=\"comment-header\">\n                    <span class=\"comment-meta\">\n                        <a class=\"text-link\" href=\"${user.html_url}\" target=\"_blank\"><strong>${user.login}</strong></a>\n                        commented\n                        <a class=\"text-link\" href=\"${html_url}\" target=\"_blank\">${timeAgo(Date.now(), new Date(created_at))}</a>\n                    </span>\n                    <div class=\"comment-actions\">\n                        ${association ? `<span class=\"author-association-badge\">${association}</span>` : ''}\n                        ${headerReactionsMenu}\n                    </div>\n                </header>\n                <div class=\"markdown-body markdown-body-scrollable\">\n                    ${body_html}\n                </div>\n                <div class=\"comment-footer\" reaction-count=\"${reactionCount}\" reaction-url=\"${reactions.url}\">\n                    <form class=\"reaction-list BtnGroup\" action=\"javascript:\">\n                        ${reactionTypes.map(id => getReactionHtml(reactions.url, id, !currentUser || locked, reactions[id])).join('')}\n                    </form>\n                    ${footerReactionsMenu}\n                </div>\n            </div>\n        `;\n\n        const markdownBody = this.element.querySelector('.markdown-body')!;\n        const emailToggle = markdownBody.querySelector('.email-hidden-toggle a') as HTMLAnchorElement;\n\n        if (emailToggle) {\n            const emailReply = markdownBody.querySelector('.email-hidden-reply') as HTMLDivElement;\n\n            emailToggle.onclick = event => {\n                event.preventDefault();\n                emailReply.classList.toggle('expanded');\n            };\n        }\n\n        processRenderedMarkdown(markdownBody);\n    }\n\n    public setCurrentUser(currentUser: string | null) {\n        if (this.currentUser === currentUser) {\n            return;\n        }\n\n        this.currentUser = currentUser;\n\n        if (this.comment.user.login === this.currentUser) {\n            this.element.classList.add('current-user');\n        } else {\n            this.element.classList.remove('current-user');\n        }\n    }\n}\n\nexport function processRenderedMarkdown(markdownBody: Element) {\n    Array.from(markdownBody.querySelectorAll<HTMLAnchorElement>(':not(.email-hidden-toggle) > a'))\n        .forEach(a => { a.target = '_top'; a.rel = 'noopener noreferrer'; });\n    Array.from(markdownBody.querySelectorAll<HTMLImageElement>('img'))\n        .forEach(img => img.onload = scheduleMeasure);\n    Array.from(markdownBody.querySelectorAll<HTMLAnchorElement>('a.commit-tease-sha'))\n        .forEach(a => a.href = 'https://github.com' + a.pathname);\n}\n","import { User, Issue, IssueComment } from './github';\nimport { CommentComponent } from './comment-component';\nimport { scheduleMeasure } from './measure';\n\nexport class TimelineComponent {\n    public readonly element: HTMLElement;\n    private readonly timeline: CommentComponent[] = [];\n    private readonly countAnchor: HTMLAnchorElement;\n    private readonly marker: Node;\n    private count: number = 0;\n\n    constructor(\n        private user: User | null,\n        private issue: Issue | null\n    ) {\n        this.element = document.createElement('main');\n        this.element.classList.add('timeline');\n        this.element.innerHTML = `\n            <h1 class=\"timeline-header\">\n                <a class=\"text-link\" target=\"_blank\"></a>\n                <em>- powered by <a class=\"text-link\" href=\"https://vartalk.cn\" target=\"_blank\">vartalk.cn</a></em>\n            </h1>\n        `;\n        this.countAnchor = this.element.firstElementChild!.firstElementChild as HTMLAnchorElement;\n        this.marker = document.createComment('marker');\n        this.element.appendChild(this.marker);\n        this.setIssue(this.issue);\n        this.renderCount();\n    }\n\n    public setUser(user: User | null) {\n        this.user = user;\n\n        const login = user ? user.login : null;\n\n        for (let i = 0; i < this.timeline.length; i++) {\n            this.timeline[i].setCurrentUser(login);\n        }\n\n        scheduleMeasure();\n    }\n\n    public setIssue(issue: Issue | null) {\n        this.issue = issue;\n\n        if (issue) {\n            this.count = issue.comments;\n            this.countAnchor.href = issue.html_url;\n            this.renderCount();\n        } else {\n            this.countAnchor.removeAttribute('href');\n        }\n    }\n\n    public insertComment(comment: IssueComment, incrementCount: boolean) {\n        const component = new CommentComponent(comment, this.user ? this.user.login : null, this.issue!.locked);\n        const index = this.timeline.findIndex(x => x.comment.id >= comment.id);\n\n        if (index === -1) {\n            this.timeline.push(component);\n            this.element.insertBefore(component.element, this.marker);\n        } else {\n            const next = this.timeline[index];\n            const remove = next.comment.id === comment.id;\n\n            this.element.insertBefore(component.element, next.element);\n            this.timeline.splice(index, remove ? 1 : 0, component);\n\n            if (remove) {\n                next.element.remove();\n            }\n        }\n\n        if (incrementCount) {\n            this.count++;\n            this.renderCount();\n        }\n\n        scheduleMeasure();\n    }\n\n    public insertPageLoader(insertAfter: IssueComment, count: number, callback: () => void) {\n        const { element: insertAfterElement } = this.timeline.find(x => x.comment.id >= insertAfter.id)!;\n\n        insertAfterElement.insertAdjacentHTML('afterend', `\n            <div class=\"page-loader\">\n                <div class=\"zigzag\"></div>\n                <button type=\"button\" class=\"btn btn-outline btn-large\">\n                    ${count} hidden items<br/>\n                    <span>Load more...</span>\n                </button>\n            </div>\n        `);\n\n        const element = insertAfterElement.nextElementSibling!;\n        const button = element.lastElementChild! as HTMLButtonElement;\n        const statusSpan = button.lastElementChild!;\n\n        button.onclick = callback;\n\n        return {\n            setBusy() {\n                statusSpan.textContent = 'Loading...';\n                button.disabled = true;\n            },\n            remove() {\n                button.onclick = null;\n                element.remove();\n            }\n        };\n    }\n\n    private renderCount() {\n        this.countAnchor.textContent = `${this.count} Comment${this.count === 1 ? '' : 's'}`;\n    }\n}\n","import { loadJsonFile } from './github';\nimport { pageAttributes } from './page-attributes';\n\nexport interface RepoConfig {\n    origins: string[];\n}\n\nlet promise: Promise<RepoConfig>;\n\nexport function getRepoConfig() {\n    if (!promise) {\n        promise = loadJsonFile<RepoConfig>('vartalk.json').then(\n            data => {\n                if (!Array.isArray(data.origins)) {\n                    data.origins = [];\n                }\n                return data;\n            },\n            () => ({\n                origins: [pageAttributes.origin]\n            })\n        );\n    }\n\n    return promise;\n}\n","import { pageAttributes as page } from './page-attributes';\nimport { User, renderMarkdown } from './github';\nimport { scheduleMeasure } from './measure';\nimport { processRenderedMarkdown } from './comment-component';\nimport { getRepoConfig } from './repo-config';\nimport { getLoginUrl } from './oauth';\n\n// tslint:disable-next-line:max-line-length\nconst anonymousAvatar = `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 14 16\" version=\"1.1\"><path fill=\"rgb(179,179,179)\" fill-rule=\"evenodd\" d=\"M8 10.5L9 14H5l1-3.5L5.25 9h3.5L8 10.5zM10 6H4L2 7h10l-2-1zM9 2L7 3 5 2 4 5h6L9 2zm4.03 7.75L10 9l1 2-2 3h3.22c.45 0 .86-.31.97-.75l.56-2.28c.14-.53-.19-1.08-.72-1.22zM4 9l-3.03.75c-.53.14-.86.69-.72 1.22l.56 2.28c.11.44.52.75.97.75H5l-2-3 1-2z\"></path></svg>`;\n// base64 encoding works in IE, Edge. UTF-8 does not.\nconst anonymousAvatarUrl = `data:image/svg+xml;base64,${btoa(anonymousAvatar)}`;\n\nconst nothingToPreview = 'Nothing to preview';\n\nexport class NewCommentComponent {\n    public readonly element: HTMLElement;\n\n    private avatarAnchor: HTMLAnchorElement;\n    private avatar: HTMLImageElement;\n    private form: HTMLFormElement;\n    private textarea: HTMLTextAreaElement;\n    private preview: HTMLDivElement;\n    private submitButton: HTMLButtonElement;\n    private signInAnchor: HTMLAnchorElement;\n\n    private submitting = false;\n    private renderTimeout = 0;\n\n    constructor(\n        private user: User | null,\n        private readonly submit: (markdown: string) => Promise<void>\n    ) {\n        this.element = document.createElement('article');\n        this.element.classList.add('timeline-comment');\n\n        this.element.innerHTML = `\n            <a class=\"avatar\" target=\"_blank\" tabindex=\"-1\"><img height=\"44\" width=\"44\"></a>\n            <form class=\"comment\" accept-charset=\"UTF-8\" action=\"javascript:\">\n                <header class=\"new-comment-header tabnav\">\n                    <div class=\"tabnav-tabs\" role=\"tablist\">\n                        <button type=\"button\" class=\"tabnav-tab tab-write\" role=\"tab\" aria-selected=\"true\">Write</button>\n                        <button type=\"button\" class=\"tabnav-tab tab-preview\" role=\"tab\">Preview</button>\n                    </div>\n                </header>\n                <div class=\"comment-body\">\n                    <textarea class=\"form-control\" placeholder=\"Leave a comment\" aria-label=\"comment\"></textarea>\n                    <div class=\"markdown-body\" style=\"display: none\">${nothingToPreview}</div>\n                </div>\n                <footer class=\"new-comment-footer\">\n                    <a class=\"text-link markdown-info\" tabindex=\"-1\" target=\"_blank\" href=\"https://guides.github.com/features/mastering-markdown/\">\n                        <svg class=\"octicon v-align-bottom\" viewBox=\"0 0 16 16\" version=\"1.1\"\n                            width=\"16\" height=\"16\" aria-hidden=\"true\">\n                            <path fill-rule=\"evenodd\" d=\"M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15\n                                13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4\n                                8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z\">\n                            </path>\n                        </svg>\n                        Styling with Markdown is supported\n                    </a>\n                    <button class=\"btn btn-primary\" type=\"submit\">Comment</button>\n                    <a class=\"btn btn-primary\" href=\"${getLoginUrl(page.url)}\" target=\"_top\">Sign in to comment</a>\n                </footer>\n            </form>\n        `;\n\n        this.avatarAnchor = this.element.firstElementChild as HTMLAnchorElement;\n        this.avatar = this.avatarAnchor.firstElementChild as HTMLImageElement;\n        this.form = this.avatarAnchor.nextElementSibling as HTMLFormElement;\n        this.textarea = this.form!.firstElementChild!.nextElementSibling!.firstElementChild as HTMLTextAreaElement;\n        this.preview = this.form!.firstElementChild!.nextElementSibling!.lastElementChild as HTMLDivElement;\n        this.signInAnchor = this.form!.lastElementChild!.lastElementChild! as HTMLAnchorElement;\n        this.submitButton = this.signInAnchor.previousElementSibling! as HTMLButtonElement;\n\n        this.setUser(user);\n        this.submitButton.disabled = true;\n\n        this.textarea.addEventListener('input', this.handleInput);\n        this.form.addEventListener('submit', this.handleSubmit);\n        this.form.addEventListener('click', this.handleClick);\n        this.form.addEventListener('keydown', this.handleKeyDown);\n        handleTextAreaResize(this.textarea);\n    }\n\n    public setUser(user: User | null) {\n        this.user = user;\n        this.submitButton.hidden = !user;\n        this.signInAnchor.hidden = !!user;\n\n        if (user) {\n            this.avatarAnchor.href = user.html_url;\n            this.avatar.alt = '@' + user.login;\n            this.avatar.src = user.avatar_url + '?v=3&s=88';\n            this.textarea.disabled = false;\n            this.textarea.placeholder = 'Leave a comment';\n        } else {\n            this.avatarAnchor.removeAttribute('href');\n            this.avatar.alt = '@anonymous';\n            this.avatar.src = anonymousAvatarUrl;\n            this.textarea.disabled = true;\n            this.textarea.placeholder = 'Sign in to comment';\n        }\n    }\n\n    public clear() {\n        this.textarea.value = '';\n    }\n\n    private handleInput = () => {\n        getRepoConfig(); // preload repo config\n\n        const text = this.textarea.value;\n        const isWhitespace = /^\\s*$/.test(text);\n\n        this.submitButton.disabled = isWhitespace;\n\n        if (this.textarea.scrollHeight < 450 && this.textarea.offsetHeight < this.textarea.scrollHeight) {\n            this.textarea.style.height = `${this.textarea.scrollHeight}px`;\n            scheduleMeasure();\n        }\n\n        clearTimeout(this.renderTimeout);\n\n        if (isWhitespace) {\n            this.preview.textContent = nothingToPreview;\n        } else {\n            this.preview.textContent = 'Loading preview...';\n            this.renderTimeout = setTimeout(\n                () => renderMarkdown(text).then(html => this.preview.innerHTML = html)\n                    .then(() => processRenderedMarkdown(this.preview))\n                    .then(scheduleMeasure),\n                500);\n        }\n    }\n\n    private handleSubmit = async (event: Event) => {\n        event.preventDefault();\n\n        if (this.submitting) {\n            return;\n        }\n\n        this.submitting = true;\n        this.textarea.disabled = true;\n        this.submitButton.disabled = true;\n        await this.submit(this.textarea.value).catch(() => 0);\n        this.submitting = false;\n        this.textarea.disabled = !this.user;\n        this.textarea.value = '';\n        this.submitButton.disabled = false;\n        this.handleClick({ ...event, target: this.form.querySelector('.tabnav-tab.tab-write') });\n        this.preview.textContent = nothingToPreview;\n    }\n\n    private handleClick = ({ target }: Event) => {\n        if (!(target instanceof HTMLButtonElement) || !target.classList.contains('tabnav-tab')) {\n            return;\n        }\n\n        if (target.getAttribute('aria-selected') === 'true') {\n            return;\n        }\n\n        this.form.querySelector('.tabnav-tab[aria-selected=\"true\"]')!.setAttribute('aria-selected', 'false');\n        target.setAttribute('aria-selected', 'true');\n        const isPreview = target.classList.contains('tab-preview');\n        this.textarea.style.display = isPreview ? 'none' : '';\n        this.preview.style.display = isPreview ? '' : 'none';\n        scheduleMeasure();\n    }\n\n    private handleKeyDown = ({ which, ctrlKey }: KeyboardEvent) => {\n        if (which === 13 && ctrlKey && !this.submitButton.disabled) {\n            this.form.dispatchEvent(new CustomEvent('submit'));\n        }\n    }\n}\n\nfunction handleTextAreaResize(textarea: HTMLTextAreaElement) {\n    const stopTracking = () => {\n        removeEventListener('mousemove', scheduleMeasure);\n        removeEventListener('mouseup', stopTracking);\n    };\n    const track = () => {\n        addEventListener('mousemove', scheduleMeasure);\n        addEventListener('mouseup', stopTracking);\n    };\n    textarea.addEventListener('mousedown', track);\n}\n","export function loadTheme(theme: string, origin: string) {\n    return new Promise(resolve => {\n        const link = document.createElement('link');\n\n        link.rel = 'stylesheet';\n        link.setAttribute('crossorigin', 'anonymous');\n        link.onload = resolve;\n        link.href = `/stylesheets/themes/${theme}/vartalk.css`;\n\n        document.head.appendChild(link);\n\n        addEventListener('message', event => {\n            if (event.origin === origin && event.data.type === 'set-theme') {\n                link.href = `/stylesheets/themes/${event.data.theme}/vartalk.css`;\n            }\n        });\n    });\n}\n","import { pageAttributes as page } from './page-attributes';\nimport {\n    Issue,\n    setRepoContext,\n    loadIssueByTerm,\n    loadIssueByNumber,\n    loadCommentsPage,\n    loadUser,\n    postComment,\n    createIssue,\n    PAGE_SIZE,\n    IssueComment\n} from './github';\nimport { TimelineComponent } from './timeline-component';\nimport { NewCommentComponent } from './new-comment-component';\nimport { startMeasuring, scheduleMeasure } from './measure';\nimport { loadTheme } from './theme';\nimport { getRepoConfig } from './repo-config';\nimport { loadToken } from './oauth';\nimport { enableReactions } from './reactions';\n\nsetRepoContext(page);\n\nfunction loadIssue(): Promise<Issue | null> {\n    if (page.issueNumber !== null) {\n        return loadIssueByNumber(page.issueNumber);\n    }\n\n    return loadIssueByTerm(page.issueTerm as string);\n}\n\nasync function bootstrap() {\n    await loadToken();\n\n    // tslint:disable-next-line:prefer-const\n    let [issue, user] = await Promise.all([\n        loadIssue(),\n        loadUser(),\n        loadTheme(page.theme, page.origin)\n    ]);\n\n    startMeasuring(page.origin);\n\n    const timeline = new TimelineComponent(user, issue);\n\n    document.body.appendChild(timeline.element);\n\n    if (issue && issue.comments > 0) {\n        renderComments(issue, timeline);\n    }\n\n    scheduleMeasure();\n\n    if (issue && issue.locked) {\n        return;\n    }\n\n    enableReactions(!!user);\n\n    const submit = async (markdown: string) => {\n        await assertOrigin();\n\n        if (!issue) {\n            issue = await createIssue(\n                page.issueTerm as string,\n                page.url,\n                page.title,\n                page.description || '',\n                page.label\n            );\n            timeline.setIssue(issue);\n        }\n\n        const comment = await postComment(issue.number, markdown);\n\n        timeline.insertComment(comment, true);\n        newCommentComponent.clear();\n    };\n\n    const newCommentComponent = new NewCommentComponent(user, submit);\n\n    timeline.element.appendChild(newCommentComponent.element);\n}\n\nbootstrap();\n\naddEventListener('not-installed', function handleNotInstalled() {\n    removeEventListener('not-installed', handleNotInstalled);\n    document.querySelector('.timeline')!.insertAdjacentHTML('afterbegin', `\n        <div class=\"flash flash-error\">\n            Error: vartalk is not installed on <code>${page.owner}/${page.repo}</code>.\n            If you own this repo,\n            <a href=\"https://github.com/apps/vartalk\" target=\"_top\"><strong>install the app</strong></a>.\n            Read more about this change in\n            <a href=\"https://github.com/utterance/utterances/pull/25\" target=\"_top\">the PR</a>.\n        </div>\n    `);\n    scheduleMeasure();\n});\n\nasync function renderComments(issue: Issue, timeline: TimelineComponent) {\n    const renderPage = (page: IssueComment[]) => {\n        for (const comment of page) {\n            timeline.insertComment(comment, false);\n        }\n    };\n\n    const pageCount = Math.ceil(issue.comments / PAGE_SIZE);\n    // always load the first page.\n    const pageLoads = [loadCommentsPage(issue.number, 1)];\n\n    // if there are multiple pages, load the last page.\n    if (pageCount > 1) {\n        pageLoads.push(loadCommentsPage(issue.number, pageCount));\n    }\n\n    // if the last page is small, load the penultimate page.\n    if (pageCount > 2 && issue.comments % PAGE_SIZE < 3) {\n        pageLoads.push(loadCommentsPage(issue.number, pageCount - 1));\n    }\n\n    // await all loads to reduce jank.\n    const pages = await Promise.all(pageLoads);\n\n    for (const page of pages) {\n        renderPage(page);\n    }\n\n    // enable loading hidden pages.\n    let hiddenPageCount = pageCount - pageLoads.length;\n    let nextHiddenPage = 2;\n    const renderLoader = (afterPage: IssueComment[]) => {\n        if (hiddenPageCount === 0) {\n            return;\n        }\n\n        const load = async () => {\n            loader.setBusy();\n\n            const page = await loadCommentsPage(issue.number, nextHiddenPage);\n\n            loader.remove();\n            renderPage(page);\n            hiddenPageCount--;\n            nextHiddenPage++;\n            renderLoader(page);\n        };\n\n        const afterComment = afterPage.pop()!;\n        const loader = timeline.insertPageLoader(afterComment, hiddenPageCount * PAGE_SIZE, load);\n    };\n\n    renderLoader(pages[0]);\n}\n\nexport async function assertOrigin() {\n    const { origins } = await getRepoConfig();\n    const { origin, owner, repo } = page;\n\n    if (origins.indexOf(origin) !== -1) {\n        return;\n    }\n\n    document.querySelector('.timeline')!.lastElementChild!.insertAdjacentHTML('beforebegin', `\n        <div class=\"flash flash-error flash-not-installed\">\n            Error: <code>${origin}</code> is not permitted to post to <code>${owner}/${repo}</code>.\n            Confirm this is the correct repo for this site's comments. If you own this repo,\n            <a href=\"https://github.com/${owner}/${repo}/edit/master/vartalk.json\" target=\"_top\">\n                <strong>update the vartalk.json</strong>\n            </a>\n            to include <code>${origin}</code> in the list of origins.<br/><br/>\n            Suggested configuration:<br/>\n            <pre><code>${JSON.stringify({ origins: [origin] }, null, 2)}</code></pre>\n        </div>\n    `);\n\n    scheduleMeasure();\n\n    throw new Error('Origin not permitted.');\n}\n"]}